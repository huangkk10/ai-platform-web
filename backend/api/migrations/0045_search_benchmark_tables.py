# Generated manually for Search Benchmark System
from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion

class Migration(migrations.Migration):
    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ("api", "0044_add_protocol_assistant_to_chat_usage"),
    ]
    
    operations = [
        migrations.CreateModel(
            name="SearchAlgorithmVersion",
            fields=[
                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False)),
                ("version_name", models.CharField(max_length=100)),
                ("version_code", models.CharField(max_length=50, unique=True)),
                ("description", models.TextField(blank=True)),
                ("algorithm_type", models.CharField(blank=True, max_length=50)),
                ("parameters", models.JSONField(default=dict)),
                ("is_active", models.BooleanField(default=True)),
                ("is_baseline", models.BooleanField(default=False)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("avg_precision", models.DecimalField(blank=True, decimal_places=4, max_digits=5, null=True)),
                ("avg_recall", models.DecimalField(blank=True, decimal_places=4, max_digits=5, null=True)),
                ("avg_response_time", models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ("total_tests", models.IntegerField(default=0)),
                ("created_by", models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name="created_versions", to=settings.AUTH_USER_MODEL)),
            ],
            options={"db_table": "search_algorithm_version", "ordering": ["-created_at"]},
        ),
        migrations.CreateModel(
            name="BenchmarkMetric",
            fields=[
                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False)),
                ("metric_name", models.CharField(max_length=100, unique=True)),
                ("metric_key", models.CharField(max_length=50, unique=True)),
                ("description", models.TextField(blank=True)),
                ("metric_type", models.CharField(blank=True, max_length=30)),
                ("calculation_method", models.TextField(blank=True)),
                ("max_score", models.DecimalField(decimal_places=2, default=100.00, max_digits=5)),
                ("min_score", models.DecimalField(decimal_places=2, default=0.00, max_digits=5)),
                ("weight", models.DecimalField(decimal_places=2, default=1.00, max_digits=3)),
                ("is_active", models.BooleanField(default=True)),
                ("display_order", models.IntegerField(default=0)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
            ],
            options={"db_table": "benchmark_metric", "ordering": ["display_order"]},
        ),
        migrations.CreateModel(
            name="BenchmarkTestCase",
            fields=[
                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False)),
                ("question", models.TextField()),
                ("question_type", models.CharField(blank=True, max_length=50)),
                ("difficulty_level", models.CharField(blank=True, max_length=20)),
                ("expected_document_ids", models.JSONField(default=list)),
                ("expected_keywords", models.JSONField(default=list)),
                ("expected_answer_summary", models.TextField(blank=True)),
                ("min_required_matches", models.IntegerField(default=1)),
                ("acceptable_document_ids", models.JSONField(default=list)),
                ("category", models.CharField(blank=True, max_length=100)),
                ("tags", models.JSONField(default=list)),
                ("source", models.CharField(blank=True, max_length=100)),
                ("is_active", models.BooleanField(default=True)),
                ("is_validated", models.BooleanField(default=False)),
                ("total_runs", models.IntegerField(default=0)),
                ("avg_score", models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("created_by", models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name="created_test_cases", to=settings.AUTH_USER_MODEL)),
            ],
            options={"db_table": "benchmark_test_case", "ordering": ["category", "difficulty_level"]},
        ),
        migrations.CreateModel(
            name="BenchmarkTestRun",
            fields=[
                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False)),
                ("run_name", models.CharField(blank=True, max_length=200)),
                ("run_type", models.CharField(default="manual", max_length=50)),
                ("total_test_cases", models.IntegerField()),
                ("completed_test_cases", models.IntegerField(default=0)),
                ("status", models.CharField(default="pending", max_length=30)),
                ("overall_score", models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ("avg_precision", models.DecimalField(blank=True, decimal_places=4, max_digits=5, null=True)),
                ("avg_recall", models.DecimalField(blank=True, decimal_places=4, max_digits=5, null=True)),
                ("avg_f1_score", models.DecimalField(blank=True, decimal_places=4, max_digits=5, null=True)),
                ("avg_response_time", models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ("started_at", models.DateTimeField(blank=True, null=True)),
                ("completed_at", models.DateTimeField(blank=True, null=True)),
                ("duration_seconds", models.IntegerField(blank=True, null=True)),
                ("environment", models.CharField(blank=True, max_length=50)),
                ("git_commit_hash", models.CharField(blank=True, max_length=40)),
                ("notes", models.TextField(blank=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("version", models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name="test_runs", to="api.searchalgorithmversion")),
                ("triggered_by", models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name="triggered_test_runs", to=settings.AUTH_USER_MODEL)),
            ],
            options={"db_table": "benchmark_test_run", "ordering": ["-created_at"]},
        ),
        migrations.CreateModel(
            name="BenchmarkTestResult",
            fields=[
                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False)),
                ("search_query", models.TextField()),
                ("returned_document_ids", models.JSONField(default=list)),
                ("returned_document_scores", models.JSONField(default=list)),
                ("precision_score", models.DecimalField(blank=True, decimal_places=4, max_digits=5, null=True)),
                ("recall_score", models.DecimalField(blank=True, decimal_places=4, max_digits=5, null=True)),
                ("f1_score", models.DecimalField(blank=True, decimal_places=4, max_digits=5, null=True)),
                ("ndcg_score", models.DecimalField(blank=True, decimal_places=4, max_digits=5, null=True)),
                ("response_time", models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ("true_positives", models.IntegerField(blank=True, null=True)),
                ("false_positives", models.IntegerField(blank=True, null=True)),
                ("false_negatives", models.IntegerField(blank=True, null=True)),
                ("is_passed", models.BooleanField(blank=True, null=True)),
                ("pass_reason", models.TextField(blank=True)),
                ("detailed_results", models.JSONField(default=dict)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("test_run", models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name="results", to="api.benchmarktestrun")),
                ("test_case", models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name="results", to="api.benchmarktestcase")),
            ],
            options={"db_table": "benchmark_test_result", "ordering": ["test_run", "id"]},
        ),
    ]
