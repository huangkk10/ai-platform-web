# Protocol Guide Markdown 驗證功能測試指南

**測試日期**：2025-11-11  
**功能版本**：v1.0  
**測試人員**：請在瀏覽器中手動測試

---

## 🎯 測試目標

驗證 Protocol Guide 新建/編輯時的 Markdown 格式驗證機制是否正常工作。

---

## 🧪 測試案例

### 測試前準備

1. **開啟瀏覽器**：訪問 `http://localhost/knowledge/protocol-log`
2. **進入新建頁面**：點擊「新增 Protocol Guide」按鈕
3. **檢查 UI**：確認 Top Header 有「返回」、「檢查格式」、「儲存」三個按鈕

---

### ✅ TC1：空內容測試

**目的**：驗證空內容會被阻擋

**步驟**：
1. 不輸入任何內容（標題和內容都保持空白）
2. 點擊「儲存」按鈕

**預期結果**：
- ❌ 顯示錯誤 Modal：「內容格式不符合要求」
- 錯誤訊息包含：「內容不能為空」
- 無法儲存到資料庫

---

### ✅ TC2：過短內容測試（如 "a"）

**目的**：驗證過短內容會被阻擋（防止 Cup 問題）

**步驟**：
1. 標題：輸入「測試」
2. 內容：只輸入「a」或任何少於 20 字元的內容
3. 點擊「儲存」按鈕

**預期結果**：
- ❌ 顯示錯誤 Modal：「內容格式不符合要求」
- 錯誤訊息包含：
  - 「內容過短（X 字元），至少需要 20 字元」
  - 「必須包含至少 1 個一級標題（# 標題）」
- 顯示標準格式範例
- 無法儲存

---

### ✅ TC3：無標題純文字測試

**目的**：驗證沒有 Markdown 標題結構的內容會被阻擋

**步驟**：
1. 標題：輸入「無標題測試」
2. 內容：輸入純文字（不使用 # 標題）
   ```
   這是一段測試內容，沒有任何 Markdown 標題結構。
   這裡有足夠的字元數量，超過二十個字元了。
   ```
3. 點擊「儲存」按鈕

**預期結果**：
- ❌ 顯示錯誤 Modal
- 錯誤訊息包含：「必須包含至少 1 個一級標題（# 標題）」
- 統計顯示：
  - 內容長度：X 字元
  - 一級標題（#）：0 個 ❌
- 顯示標準格式範例
- 無法儲存

---

### ✅ TC4：只有一級標題（無二級標題）

**目的**：驗證只有一級標題會顯示警告，但允許儲存

**步驟**：
1. 標題：輸入「單標題測試」
2. 內容：
   ```markdown
   # Protocol 測試指南
   
   這是測試內容，有一級標題但沒有二級標題。
   這裡有足夠的內容長度。
   ```
3. 點擊「儲存」按鈕

**預期結果**：
- ⚠️ 顯示警告 Modal：「內容建議改進」
- 統計顯示：
  - 一級標題（#）：1 個 ✅
  - 二級標題（##）：0 個 ⚠️
- 警告訊息：「建議添加二級標題（## 標題）來組織內容結構」
- 提供兩個選項：「返回修改」和「繼續儲存」
- 點擊「繼續儲存」應該可以成功儲存

---

### ✅ TC5：完整 Markdown 結構

**目的**：驗證完整格式直接通過，不顯示任何提示

**步驟**：
1. 標題：輸入「完整格式測試」
2. 內容：
   ```markdown
   # Protocol 測試指南
   
   ## 測試目的
   驗證 Protocol 功能是否正常。
   
   ## 測試步驟
   1. 步驟一：準備測試環境
   2. 步驟二：執行測試
   3. 步驟三：記錄結果
   
   ## 預期結果
   描述預期的測試結果...
   ```
3. 點擊「儲存」按鈕

**預期結果**：
- ✅ **不顯示任何 Modal**（直接儲存）
- 自動跳轉回列表頁
- 在列表中可以看到新建的記錄

---

### ✅ TC6：「檢查格式」按鈕測試

**目的**：驗證手動格式檢查功能

**步驟**：
1. 進入新建頁面
2. 輸入各種內容（空白、過短、無標題、完整格式）
3. 點擊「檢查格式」按鈕（不點儲存）

**預期結果**：
- **空白內容**：顯示錯誤 Modal
- **過短內容**：顯示錯誤 Modal
- **無標題**：顯示錯誤 Modal
- **只有一級標題**：顯示成功 Modal（但有改進建議）
- **完整格式**：顯示成功 Modal ✅

---

### ✅ TC7：編輯模式測試

**目的**：驗證編輯現有記錄時驗證也生效

**步驟**：
1. 從列表頁點擊「編輯」進入編輯模式
2. 將內容改為無效格式（如刪除所有標題）
3. 點擊「儲存」按鈕

**預期結果**：
- 應該阻擋儲存（和新建模式相同）
- 顯示相應的錯誤訊息

---

### ✅ TC8：空標題測試

**目的**：驗證空標題會被檢測

**步驟**：
1. 標題：輸入「空標題測試」
2. 內容：
   ```markdown
   # 
   
   這是一個空標題的例子。
   
   ## 正常標題
   正常內容...
   ```
3. 點擊「儲存」按鈕

**預期結果**：
- ❌ 顯示錯誤 Modal
- 錯誤訊息：「發現 1 個空標題（標題後面沒有文字）」
- 無法儲存

---

## 🎯 驗證點檢查清單

### 功能性驗證
- [ ] TC1：空內容被阻擋 ✅
- [ ] TC2：過短內容（< 20 字元）被阻擋 ✅
- [ ] TC3：無標題純文字被阻擋 ✅
- [ ] TC4：只有一級標題顯示警告但可儲存 ⚠️
- [ ] TC5：完整格式直接通過 ✅
- [ ] TC6：「檢查格式」按鈕正常工作 ✅
- [ ] TC7：編輯模式驗證生效 ✅
- [ ] TC8：空標題被檢測 ✅

### UI/UX 驗證
- [ ] 錯誤 Modal 顯示清晰的錯誤訊息
- [ ] 包含內容統計資訊（長度、標題數量）
- [ ] 顯示標準格式範例
- [ ] 警告 Modal 提供「返回修改」和「繼續儲存」選項
- [ ] Modal 置中顯示（`centered: true`）
- [ ] 錯誤訊息使用紅色，警告使用橙色

### 相容性驗證
- [ ] RVT Guide 不受影響（沒有驗證機制）
- [ ] 只有 Protocol Guide 頁面顯示「檢查格式」按鈕
- [ ] 現有的 Protocol Guide 資料可以正常編輯

---

## 📊 測試結果記錄

### 測試環境
- **瀏覽器**：Chrome / Firefox / Safari
- **前端版本**：ai-react (最新)
- **測試日期**：____________________
- **測試人員**：____________________

### 測試結果
| 案例 | 通過 | 失敗 | 備註 |
|------|------|------|------|
| TC1: 空內容 | ☐ | ☐ | |
| TC2: 過短內容 | ☐ | ☐ | |
| TC3: 無標題文字 | ☐ | ☐ | |
| TC4: 只有一級標題 | ☐ | ☐ | |
| TC5: 完整格式 | ☐ | ☐ | |
| TC6: 檢查格式按鈕 | ☐ | ☐ | |
| TC7: 編輯模式 | ☐ | ☐ | |
| TC8: 空標題 | ☐ | ☐ | |

### 問題記錄
（如果發現任何問題，請在此記錄）

1. _______________________________________________
2. _______________________________________________
3. _______________________________________________

---

## 🐛 除錯指引

### 如果驗證沒有觸發

1. **檢查瀏覽器 Console**：
   - 打開開發者工具（F12）
   - 查看 Console 標籤
   - 應該看到：「🔍 開始驗證 Protocol Guide Markdown 格式...」

2. **檢查 contentType**：
   - 在 Console 中確認 `contentType` 是 `'protocol-guide'`
   - 如果不是，檢查 URL 路徑是否包含 `/protocol-guide/`

3. **檢查檔案是否更新**：
   ```bash
   # 檢查檔案修改時間
   ls -la frontend/src/utils/markdownValidator.js
   ls -la frontend/src/components/editor/MarkdownEditorLayout.jsx
   ```

### 如果 Modal 沒有顯示

1. **檢查 Ant Design Modal 是否正常**：
   - 確認 `import { Modal } from 'antd';` 存在
   - 檢查是否有 CSS 樣式衝突

2. **檢查驗證結果**：
   - 在 Console 中查看：「📊 驗證結果: {...}」
   - 確認 `valid`, `errors`, `warnings` 欄位

### 如果「檢查格式」按鈕沒有顯示

1. **檢查 URL 路徑**：
   - 必須是 `/knowledge/protocol-guide/markdown-create` 或 `markdown-edit/:id`
   - RVT Guide 路徑不會顯示此按鈕

2. **檢查條件渲染**：
   ```javascript
   {editorConfig.contentType === 'protocol-guide' && (
     <Button>檢查格式</Button>
   )}
   ```

---

## ✅ 測試完成標準

- [ ] 所有 8 個測試案例都通過
- [ ] UI/UX 符合設計預期
- [ ] 沒有發現 Console 錯誤
- [ ] RVT Guide 功能不受影響
- [ ] 編輯模式和新建模式都正常

---

**測試文檔版本**：v1.0  
**最後更新**：2025-11-11  
**維護者**：AI Platform Team
