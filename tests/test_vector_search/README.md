# å‘é‡æœå°‹æ¸¬è©¦å¥—ä»¶

é€™å€‹ç›®éŒ„åŒ…å«äº†å®Œæ•´çš„å‘é‡æœå°‹ç³»çµ±æ¸¬è©¦è…³æœ¬ï¼Œç”¨æ–¼é©—è­‰æ–°çš„æ®µè½ç´šåˆ¥æœå°‹ç³»çµ±ï¼ˆdocument_section_embeddingsï¼‰ç›¸å°æ–¼èˆŠçš„æ•´ç¯‡æ–‡æª”æœå°‹ç³»çµ±ï¼ˆdocument_embeddingsï¼‰çš„æ•ˆèƒ½å’Œæº–ç¢ºåº¦ã€‚

## ğŸ“ ç›®éŒ„çµæ§‹

```
test_vector_search/
â”œâ”€â”€ README.md                              # æœ¬æ–‡ä»¶
â”œâ”€â”€ test_section_search_comparison.py      # ğŸ¯ æ ¸å¿ƒï¼šæ–°èˆŠç³»çµ±å®Œæ•´å°æ¯”
â”œâ”€â”€ test_search_accuracy.py                # ğŸ“Š æº–ç¢ºåº¦å°ˆé …æ¸¬è©¦
â”œâ”€â”€ test_search_performance.py             # âš¡ æ•ˆèƒ½å°ˆé …æ¸¬è©¦
â”œâ”€â”€ test_data/
â”‚   â””â”€â”€ test_queries.json                  # æ¸¬è©¦æŸ¥è©¢æ•¸æ“šé›†
â””â”€â”€ reports/                               # æ¸¬è©¦å ±å‘Šè¼¸å‡ºç›®éŒ„
    â”œâ”€â”€ comparison_YYYYMMDD_HHMMSS.csv     # å°æ¯”æ¸¬è©¦è©³ç´°æ•¸æ“š
    â”œâ”€â”€ comparison_YYYYMMDD_HHMMSS.md      # å°æ¯”æ¸¬è©¦ç¸½çµå ±å‘Š
    â”œâ”€â”€ accuracy_report_YYYYMMDD.md        # æº–ç¢ºåº¦æ¸¬è©¦å ±å‘Š
    â”œâ”€â”€ performance_YYYYMMDD.json          # æ•ˆèƒ½æ¸¬è©¦è©³ç´°æ•¸æ“š
    â””â”€â”€ performance_YYYYMMDD.md            # æ•ˆèƒ½æ¸¬è©¦ç¸½çµå ±å‘Š
```

## ğŸ¯ æ¸¬è©¦ç›®æ¨™

æœ¬æ¸¬è©¦å¥—ä»¶çš„ç›®æ¨™æ˜¯å›ç­”ä»¥ä¸‹é—œéµå•é¡Œï¼š

1. **æ–°ç³»çµ±æ˜¯å¦æ›´å¥½ï¼Ÿ**
   - æº–ç¢ºåº¦æ˜¯å¦æå‡ï¼Ÿ
   - å…§å®¹æ˜¯å¦æ›´ç²¾ç°¡ï¼Ÿ
   - å›æ‡‰é€Ÿåº¦æ˜¯å¦å¯æ¥å—ï¼Ÿ

2. **å¥½å¤šå°‘ï¼Ÿ**
   - ç›¸ä¼¼åº¦æå‡ç™¾åˆ†æ¯”
   - å…§å®¹ç²¾ç°¡ç¨‹åº¦
   - å‹ç‡çµ±è¨ˆ

3. **å€¼å¾—åˆ‡æ›å—ï¼Ÿ**
   - æ˜¯å¦æœ‰è² é¢å½±éŸ¿ï¼Ÿ
   - ä½¿ç”¨è€…é«”é©—æ˜¯å¦æ”¹å–„ï¼Ÿ
   - ç³»çµ±è³‡æºæ¶ˆè€—æ˜¯å¦åˆç†ï¼Ÿ

4. **æœ€ä½³åƒæ•¸æ˜¯ä»€éº¼ï¼Ÿ**
   - æœ€ä½³ top_k å€¼
   - æœ€ä½³ threshold é–¾å€¼
   - æœ€ä½³æŸ¥è©¢ç­–ç•¥

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. ç’°å¢ƒæº–å‚™

ç¢ºä¿ Django ç’°å¢ƒå·²æ­£ç¢ºé…ç½®ï¼š

```bash
# ç¢ºèª Docker å®¹å™¨é‹è¡Œä¸­
docker compose ps

# ç¢ºèª PostgreSQL å’Œ Django å®¹å™¨æ­£å¸¸
docker logs ai-django
docker logs postgres_db
```

### 2. åŸ·è¡Œæ¸¬è©¦

#### ğŸ¯ æ ¸å¿ƒå°æ¯”æ¸¬è©¦ï¼ˆæ¨è–¦å„ªå…ˆåŸ·è¡Œï¼‰

```bash
# åœ¨å®¹å™¨å…§åŸ·è¡Œ
docker exec -it ai-django python tests/test_vector_search/test_section_search_comparison.py

# æˆ–åœ¨ä¸»æ©ŸåŸ·è¡Œï¼ˆéœ€è¦ Python ç’°å¢ƒï¼‰
cd /home/kevin/PythonCode/ai-platform-web
python tests/test_vector_search/test_section_search_comparison.py
```

**é è¨ˆåŸ·è¡Œæ™‚é–“**: 3-5 åˆ†é˜ï¼ˆå–æ±ºæ–¼æ¸¬è©¦æŸ¥è©¢æ•¸é‡ï¼‰

**è¼¸å‡º**:
- `reports/comparison_YYYYMMDD_HHMMSS.csv` - è©³ç´°æ•¸æ“š
- `reports/comparison_YYYYMMDD_HHMMSS.md` - ç¸½çµå ±å‘Š

**å ±å‘Šå…§å®¹**:
- æ–°èˆŠç³»çµ±å‹ç‡çµ±è¨ˆ
- å¹³å‡ç›¸ä¼¼åº¦æ”¹å–„
- å¹³å‡å…§å®¹ç²¾ç°¡ç¨‹åº¦
- Top 10 æ”¹å–„æœ€å¤šçš„æŸ¥è©¢
- Top 10 å…§å®¹ç²¾ç°¡æœ€å¤šçš„æŸ¥è©¢

#### ğŸ“Š æº–ç¢ºåº¦æ¸¬è©¦

```bash
docker exec -it ai-django python tests/test_vector_search/test_search_accuracy.py
```

**é è¨ˆåŸ·è¡Œæ™‚é–“**: 2-3 åˆ†é˜

**è¼¸å‡º**:
- `reports/accuracy_report_YYYYMMDD.md`

**å ±å‘Šå…§å®¹**:
- æŒ‰æŸ¥è©¢é¡å‹åˆ†é¡çš„æº–ç¢ºåº¦çµ±è¨ˆ
- Top-1, Top-3 æº–ç¢ºç‡
- è¦†è“‹ç‡åˆ†æ
- æœ€éœ€è¦æ”¹é€²çš„æŸ¥è©¢é¡å‹

#### âš¡ æ•ˆèƒ½æ¸¬è©¦

```bash
docker exec -it ai-django python tests/test_vector_search/test_search_performance.py
```

**é è¨ˆåŸ·è¡Œæ™‚é–“**: 5-10 åˆ†é˜ï¼ˆåŒ…å«å£“åŠ›æ¸¬è©¦ï¼‰

**è¼¸å‡º**:
- `reports/performance_YYYYMMDD.json` - è©³ç´°æ•¸æ“š
- `reports/performance_YYYYMMDD.md` - ç¸½çµå ±å‘Š

**å ±å‘Šå…§å®¹**:
- å–®æ¬¡æœå°‹å¹³å‡è€—æ™‚
- æ‰¹é‡æœå°‹ååé‡
- ä¸åŒåƒæ•¸ï¼ˆtop_k, thresholdï¼‰å°æ•ˆèƒ½çš„å½±éŸ¿
- å£“åŠ›æ¸¬è©¦çµæœï¼ˆé€£çºŒ/ä¸¦ç™¼ï¼‰
- P95, P99 å»¶é²çµ±è¨ˆ
- æœ€ä½³åƒæ•¸å»ºè­°

## ğŸ“Š æ¸¬è©¦æ•¸æ“š

### test_queries.json çµæ§‹

æ¸¬è©¦æ•¸æ“šé›†åŒ…å« 6 ç¨®é¡å‹çš„æŸ¥è©¢ï¼š

1. **basic_queries** (10 å€‹)
   - åŸºæœ¬é—œéµå­—æŸ¥è©¢
   - ä¾‹: "ULINK é€£æ¥å¤±æ•—", "æ¸¬è©¦ç’°å¢ƒæº–å‚™"

2. **technical_queries** (10 å€‹)
   - æŠ€è¡“å°ˆæ¥­è¡“èªæŸ¥è©¢
   - ä¾‹: "OpenCV ç‰ˆæœ¬ç›¸å®¹æ€§", "pytest fixture ä½¿ç”¨æ–¹æ³•"

3. **semantic_queries** (10 å€‹)
   - èªç¾©ç†è§£æŸ¥è©¢ï¼ˆåŒç¾©è©ã€æ„åœ–ç†è§£ï¼‰
   - ä¾‹: "å¦‚ä½•é™¤éŒ¯ç¨‹å¼", "æ¸¬è©¦å¤±æ•—æ€éº¼è¾¦"

4. **edge_cases** (10 å€‹)
   - é‚Šç•Œæ¡ˆä¾‹æŸ¥è©¢
   - ä¾‹: è¶…çŸ­æŸ¥è©¢ã€è¶…é•·æŸ¥è©¢ã€ç‰¹æ®Šç¬¦è™Ÿ

5. **protocol_specific** (10 å€‹)
   - Protocol Guide ç‰¹å®šæŸ¥è©¢
   - ä¾‹: "ULINK Protocol æ¸¬è©¦åŸºç¤æŒ‡å—"

6. **real_world_examples** (10 å€‹)
   - çœŸå¯¦ç”¨æˆ¶å¯èƒ½æå•çš„æ–¹å¼
   - ä¾‹: "ç‚ºä»€éº¼ ULINK ä¸€ç›´é€£æ¥å¤±æ•—ï¼Ÿ"

**ç¸½è¨ˆ**: 60 å€‹æ¸¬è©¦æŸ¥è©¢

### è‡ªè¨‚æ¸¬è©¦æ•¸æ“š

ä½ å¯ä»¥ç·¨è¼¯ `test_data/test_queries.json` ä¾†æ·»åŠ æˆ–ä¿®æ”¹æ¸¬è©¦æŸ¥è©¢ï¼š

```json
{
  "basic_queries": [
    "ä½ çš„æŸ¥è©¢ 1",
    "ä½ çš„æŸ¥è©¢ 2"
  ],
  "custom_category": [
    "è‡ªè¨‚é¡åˆ¥æŸ¥è©¢ 1",
    "è‡ªè¨‚é¡åˆ¥æŸ¥è©¢ 2"
  ]
}
```

## ğŸ“ˆ é æœŸçµæœ

æ ¹æ“šåˆæ­¥æ¸¬è©¦ï¼Œæ–°ç³»çµ±é æœŸæœ‰ä»¥ä¸‹æ”¹å–„ï¼š

| æŒ‡æ¨™ | èˆŠç³»çµ± | æ–°ç³»çµ± | æ”¹å–„å¹…åº¦ |
|------|--------|--------|----------|
| å¹³å‡ç›¸ä¼¼åº¦ | 86.62% | 91.45% | +5.6% |
| å¹³å‡å…§å®¹é•·åº¦ | 1404 å­—å…ƒ | 52 å­—å…ƒ | -96.3% |
| æœå°‹é€Ÿåº¦ | 135ms | 120ms | +11% |
| å‹ç‡ | - | 72% | - |

## ğŸ¯ æˆåŠŸæ¨™æº–

### å»ºè­°åˆ‡æ›åˆ°æ–°ç³»çµ±çš„æ¢ä»¶ï¼š

1. âœ… **æ–°ç³»çµ±å‹ç‡ > 70%**
2. âœ… **å¹³å‡ç›¸ä¼¼åº¦æå‡ > 5%**
3. âœ… **å…§å®¹ç²¾ç°¡ > 90%**
4. âœ… **æœå°‹é€Ÿåº¦ < 200ms**
5. âœ… **ç„¡æ˜é¡¯è² é¢å½±éŸ¿**

### éœ€è¦ç¹¼çºŒå„ªåŒ–çš„æƒ…æ³ï¼š

- âš ï¸ å‹ç‡ 50-70%ï¼šéƒ¨åˆ†æŸ¥è©¢é¡å‹éœ€è¦æ”¹é€²
- âš ï¸ ç›¸ä¼¼åº¦æå‡ 2-5%ï¼šæ•ˆæœä¸å¤ æ˜é¡¯
- âš ï¸ æŸäº›æŸ¥è©¢é¡å‹æº–ç¢ºåº¦ä¸‹é™ï¼šéœ€è¦é‡å°æ€§å„ªåŒ–

### ä¸å»ºè­°åˆ‡æ›çš„æƒ…æ³ï¼š

- âŒ å‹ç‡ < 50%ï¼šèˆŠç³»çµ±è¡¨ç¾æ›´å¥½
- âŒ ç›¸ä¼¼åº¦æå‡ < 2%ï¼šæ”¹å–„ä¸æ˜é¡¯
- âŒ æ•ˆèƒ½é¡¯è‘—ä¸‹é™ï¼ˆ> 300msï¼‰

## ğŸ”§ æ¸¬è©¦åƒæ•¸èª¿æ•´

### ä¿®æ”¹æ¸¬è©¦åƒæ•¸

ä½ å¯ä»¥åœ¨å„æ¸¬è©¦è…³æœ¬ä¸­èª¿æ•´åƒæ•¸ï¼š

```python
# test_section_search_comparison.py
tester.run_all_tests(
    top_k=3,           # è¿”å›çµæœæ•¸é‡ (å»ºè­°: 3-5)
    threshold=0.7      # ç›¸ä¼¼åº¦é–¾å€¼ (å»ºè­°: 0.6-0.8)
)

# test_search_performance.py
tester.test_stress_continuous(
    iterations=100     # é€£çºŒæœå°‹æ¬¡æ•¸ (å»ºè­°: 100-500)
)
tester.test_stress_concurrent(
    workers=5,                 # ä¸¦ç™¼æ•¸ (å»ºè­°: 5-20)
    iterations_per_worker=10   # æ¯å€‹ worker åŸ·è¡Œæ¬¡æ•¸
)
```

### åƒæ•¸å»ºè­°

| åƒæ•¸ | é è¨­å€¼ | å»ºè­°ç¯„åœ | èªªæ˜ |
|------|--------|----------|------|
| top_k | 3 | 1-10 | è¿”å›çµæœæ•¸é‡ï¼Œè¶Šå¤§çµæœè¶Šå¤šä½†å¯èƒ½ä¸ç²¾ç¢º |
| threshold | 0.7 | 0.5-0.9 | ç›¸ä¼¼åº¦é–¾å€¼ï¼Œè¶Šé«˜çµæœè¶Šç²¾ç¢ºä½†å¯èƒ½éºæ¼ |
| iterations | 10 | 5-20 | å–®æ¬¡æ¸¬è©¦é‡è¤‡æ¬¡æ•¸ï¼Œè¶Šå¤šè¶Šæº–ç¢º |
| workers | 5 | 1-20 | ä¸¦ç™¼æ¸¬è©¦ worker æ•¸é‡ |

## ğŸ“ æ¸¬è©¦å ±å‘Šè§£è®€

### CSV å ±å‘Šæ¬„ä½èªªæ˜

`comparison_YYYYMMDD_HHMMSS.csv`:

| æ¬„ä½ | èªªæ˜ |
|------|------|
| query | æ¸¬è©¦æŸ¥è©¢ |
| winner | å‹å‡ºç³»çµ± (æ–°ç³»çµ±/èˆŠç³»çµ±/å¹³æ‰‹) |
| old_avg_similarity | èˆŠç³»çµ±å¹³å‡ç›¸ä¼¼åº¦ (%) |
| new_avg_similarity | æ–°ç³»çµ±å¹³å‡ç›¸ä¼¼åº¦ (%) |
| similarity_improvement | ç›¸ä¼¼åº¦æ”¹å–„ (ç™¾åˆ†é») |
| old_avg_content_length | èˆŠç³»çµ±å¹³å‡å…§å®¹é•·åº¦ (å­—å…ƒ) |
| new_avg_content_length | æ–°ç³»çµ±å¹³å‡å…§å®¹é•·åº¦ (å­—å…ƒ) |
| content_reduction_pct | å…§å®¹ç²¾ç°¡ç¨‹åº¦ (%) |
| new_level_distribution | æ–°ç³»çµ±æ®µè½å±¤ç´šåˆ†å¸ƒ |

### Markdown å ±å‘Šçµæ§‹

æ‰€æœ‰ Markdown å ±å‘ŠåŒ…å«ï¼š

1. **æ¸¬è©¦ç¸½è¦½** - æ•´é«”çµ±è¨ˆæ•¸æ“š
2. **è©³ç´°æ•¸æ“š** - å„é …æŒ‡æ¨™è©³ç´°åˆ†æ
3. **çµè«–èˆ‡å»ºè­°** - æ¸¬è©¦çµè«–å’Œä¸‹ä¸€æ­¥å»ºè­°
4. **æ¸¬è©¦é…ç½®** - æ¸¬è©¦åƒæ•¸å’Œç’°å¢ƒè³‡è¨Š

## ğŸ› æ•…éšœæ’é™¤

### å•é¡Œ 1: Django è¨­å®šéŒ¯èª¤

**éŒ¯èª¤è¨Šæ¯**: `django.core.exceptions.ImproperlyConfigured`

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# ç¢ºèªåœ¨æ­£ç¢ºçš„ç›®éŒ„
cd /home/kevin/PythonCode/ai-platform-web

# ç¢ºèª DJANGO_SETTINGS_MODULE ç’°å¢ƒè®Šæ•¸
export DJANGO_SETTINGS_MODULE=ai_platform.settings

# æˆ–åœ¨ Docker å®¹å™¨å…§åŸ·è¡Œ
docker exec -it ai-django python tests/test_vector_search/test_section_search_comparison.py
```

### å•é¡Œ 2: æ¨¡çµ„æ‰¾ä¸åˆ°

**éŒ¯èª¤è¨Šæ¯**: `ModuleNotFoundError: No module named 'library'`

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# ç¢ºèª Python è·¯å¾‘åŒ…å«å°ˆæ¡ˆæ ¹ç›®éŒ„
# æ¸¬è©¦è…³æœ¬å·²è‡ªå‹•æ·»åŠ ï¼Œå¦‚æœä»æœ‰å•é¡Œï¼š
export PYTHONPATH=/home/kevin/PythonCode/ai-platform-web:$PYTHONPATH
```

### å•é¡Œ 3: è³‡æ–™åº«é€£æ¥å¤±æ•—

**éŒ¯èª¤è¨Šæ¯**: `psycopg2.OperationalError: could not connect to server`

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æª¢æŸ¥ PostgreSQL å®¹å™¨ç‹€æ…‹
docker compose ps postgres_db

# é‡å•Ÿ PostgreSQL å®¹å™¨
docker compose restart postgres_db

# æª¢æŸ¥è³‡æ–™åº«é€£æ¥
docker exec postgres_db psql -U postgres -d ai_platform -c "SELECT 1;"
```

### å•é¡Œ 4: å‘é‡è³‡æ–™ä¸å­˜åœ¨

**éŒ¯èª¤è¨Šæ¯**: `No vectors found in document_section_embeddings`

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æª¢æŸ¥å‘é‡æ•¸é‡
docker exec postgres_db psql -U postgres -d ai_platform -c "
SELECT COUNT(*) FROM document_section_embeddings WHERE source_table = 'protocol_guide';
"

# å¦‚æœç‚º 0ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆå‘é‡ï¼ˆåƒè€ƒ Step 5 æ–‡æª”ï¼‰
```

## ğŸ“š ç›¸é—œæ–‡æª”

- **Step 7 å®Œæˆå ±å‘Š**: `docs/features/protocol-section-search-api-integration-complete.md`
- **å‘é‡æœå°‹å¿«é€Ÿåƒè€ƒ**: `docs/vector-search/vector-search-quick-reference.md`
- **å‘é‡æœå°‹å®Œæ•´æŒ‡å—**: `docs/vector-search/vector-search-guide.md`
- **Protocol Assistant å‘é‡è¨­ç½®**: `docs/features/protocol-assistant-vector-database-setup.md`

## ğŸ”„ æŒçºŒæ”¹é€²

### å¦‚ä½•æ ¹æ“šæ¸¬è©¦çµæœæ”¹é€²ç³»çµ±

1. **æº–ç¢ºåº¦ä¸ä½³**:
   - èª¿æ•´ threshold é–¾å€¼
   - æª¢æŸ¥ Embedding æ¨¡å‹æ˜¯å¦é©åˆ
   - å¢åŠ è¨“ç·´æ•¸æ“š

2. **æ•ˆèƒ½ä¸ä½³**:
   - èª¿æ•´è³‡æ–™åº«ç´¢å¼• (IVFFlat lists åƒæ•¸)
   - å„ªåŒ–æŸ¥è©¢é‚è¼¯
   - è€ƒæ…®ä½¿ç”¨å¿«å–

3. **ç‰¹å®šæŸ¥è©¢é¡å‹è¡¨ç¾å·®**:
   - é‡å°è©²é¡å‹å¢åŠ å°ˆé–€çš„æ¸¬è©¦æ•¸æ“š
   - è€ƒæ…®ä½¿ç”¨æŸ¥è©¢æ“´å±• (Query Expansion)
   - èª¿æ•´åˆ†æ®µé‚è¼¯

## ğŸ‘¥ è²¢ç»

å¦‚æœä½ ç™¼ç¾æ¸¬è©¦è…³æœ¬æœ‰å•é¡Œæˆ–æœ‰æ”¹é€²å»ºè­°ï¼Œè«‹ï¼š

1. æäº¤ Issue æè¿°å•é¡Œ
2. æˆ–ç›´æ¥æäº¤ Pull Request
3. æˆ–è¯ç¹«å°ˆæ¡ˆç¶­è­·è€…

## ğŸ“„ æˆæ¬Š

æœ¬æ¸¬è©¦å¥—ä»¶éµå¾ªå°ˆæ¡ˆä¸»æˆæ¬Šæ¢æ¬¾ã€‚

---

**æœ€å¾Œæ›´æ–°**: 2025-10-20  
**ç‰ˆæœ¬**: v1.0  
**ç¶­è­·è€…**: AI Platform Team
