# ğŸ› åœ–ç‰‡é è¦½é™¤éŒ¯æŒ‡å—

## ğŸ“‹ å•é¡Œæè¿°
Protocol Guide ç·¨è¼¯å™¨çš„å³å´é è¦½é¢æ¿é¡¯ç¤ºçš„æ˜¯åœ–ç‰‡åœ–æ¨™å’Œæª”åï¼Œè€Œä¸æ˜¯å¯¦éš›çš„åœ–ç‰‡ç¸®ç•¥åœ–ã€‚

## ğŸ”§ æœ€æ–°ä¿®æ”¹ (2025-10-31)

### ä¿®æ”¹å…§å®¹
1. **å¢åŠ é™¤éŒ¯æ—¥èªŒ**ï¼šåœ¨ `useEffect` ä¸­æ·»åŠ è©³ç´°çš„ console.log
2. **å¢åŠ å»¶é²æ™‚é–“**ï¼šå¾ 100ms å¢åŠ åˆ° 300ms
3. **å¤šé‡é¸æ“‡å™¨**ï¼šå˜—è©¦å¤šç¨® DOM é¸æ“‡å™¨æ‰¾åˆ°åœ–ç‰‡å…ƒç´ 
4. **å‚™ç”¨ ID æå–**ï¼šå¦‚æœæ²’æœ‰ `data-image-id`ï¼Œå¾ `src` ä¸­æå–
5. **å¼·åŒ–æ¨£å¼**ï¼šæ·»åŠ æ›´å¤šå…§è¯æ¨£å¼ç¢ºä¿åœ–ç‰‡æ­£ç¢ºé¡¯ç¤º

### ä¿®æ”¹æª”æ¡ˆ
- `frontend/src/components/editor/MarkdownEditorLayout.jsx`ï¼ˆLines 442-530ï¼‰

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šé–‹å•Ÿé–‹ç™¼è€…å·¥å…·
1. æ‰“é–‹ç€è¦½å™¨ï¼ˆChrome/Edgeï¼‰
2. æŒ‰ **F12** æ‰“é–‹é–‹ç™¼è€…å·¥å…·
3. åˆ‡æ›åˆ° **Consoleï¼ˆæ§åˆ¶å°ï¼‰** åˆ†é 

### æ­¥é©Ÿ 2ï¼šé€²å…¥ç·¨è¼¯é é¢
è¨ªå•ï¼šhttp://10.10.172.127/knowledge/protocol-guide/markdown-edit/76

### æ­¥é©Ÿ 3ï¼šè¼¸å…¥æ¸¬è©¦å…§å®¹
åœ¨å·¦å´ç·¨è¼¯å™¨ä¸­è¼¸å…¥ï¼š

```markdown
## æ¸¬è©¦åœ–ç‰‡é¡¯ç¤º

æ¸¬è©¦åœ–ç‰‡ 1: [IMG:41]
æ¸¬è©¦åœ–ç‰‡ 2: [IMG:42]
æ¸¬è©¦åœ–ç‰‡ 3: [IMG:43]
```

### æ­¥é©Ÿ 4ï¼šè§€å¯Ÿæ§åˆ¶å°è¼¸å‡º
**é æœŸçœ‹åˆ°çš„æ—¥èªŒ**ï¼š
```
ğŸ–¼ï¸ [åœ–ç‰‡åŠ è¼‰ useEffect] è§¸ç™¼ï¼Œå…§å®¹é•·åº¦: XXX
â° [åœ–ç‰‡åŠ è¼‰] é–‹å§‹è™•ç†...
âœ… [åœ–ç‰‡åŠ è¼‰] æ‰¾åˆ°é è¦½é¢æ¿: rc-md-preview
ğŸ¯ [åœ–ç‰‡åŠ è¼‰] æ‰¾åˆ°æ¨™æº–åœ–ç‰‡æ•¸: 3
ğŸ”„ [åœ–ç‰‡ 41] é–‹å§‹è¼‰å…¥...
âœ… [åœ–ç‰‡ 41] API å›æ‡‰æˆåŠŸï¼ŒåŒ…å« data_url: true
âœ… [åœ–ç‰‡ 41] è¼‰å…¥æˆåŠŸï¼
ğŸ”„ [åœ–ç‰‡ 42] é–‹å§‹è¼‰å…¥...
âœ… [åœ–ç‰‡ 42] API å›æ‡‰æˆåŠŸï¼ŒåŒ…å« data_url: true
âœ… [åœ–ç‰‡ 42] è¼‰å…¥æˆåŠŸï¼
...
```

### æ­¥é©Ÿ 5ï¼šè§€å¯Ÿé è¦½é¢æ¿
**é æœŸçµæœ**ï¼š
- âœ… åœ–ç‰‡æ‡‰è©²é¡¯ç¤ºç‚ºå¯¦éš›çš„ç¸®ç•¥åœ–
- âœ… åœ–ç‰‡æ‡‰è©²æœ‰ç¶ è‰²é‚Šæ¡†ï¼ˆè¡¨ç¤ºæˆåŠŸï¼‰
- âœ… åœ–ç‰‡å¤§å°ç´„ 100px å¯¬
- âœ… åœ–ç‰‡å¯ä»¥çœ‹åˆ°å¯¦éš›å…§å®¹

**éŒ¯èª¤çµæœ**ï¼š
- âŒ ä»ç„¶é¡¯ç¤ºåœ–ç‰‡åœ–æ¨™ + æª”å
- âŒ åœ–ç‰‡æœ‰ç´…è‰²é‚Šæ¡†ï¼ˆè¼‰å…¥å¤±æ•—ï¼‰
- âŒ æ§åˆ¶å°æœ‰éŒ¯èª¤è¨Šæ¯

## ğŸ” é™¤éŒ¯æ¸…å–®

### å•é¡Œ Aï¼šæ§åˆ¶å°é¡¯ç¤ºã€Œæ‰¾ä¸åˆ°é è¦½é¢æ¿ã€
```
âŒ [åœ–ç‰‡åŠ è¼‰] æ‰¾ä¸åˆ°é è¦½é¢æ¿
```

**å¯èƒ½åŸå› **ï¼šDOM çµæ§‹è®Šæ›´
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. åœ¨æ§åˆ¶å°åŸ·è¡Œï¼š
   ```javascript
   document.querySelector('.rc-md-editor')
   ```
2. æª¢æŸ¥æ˜¯å¦æœ‰é€™å€‹å…ƒç´ 
3. å¦‚æœæ²’æœ‰ï¼ŒæŸ¥çœ‹å¯¦éš›çš„ DOM çµæ§‹

### å•é¡Œ Bï¼šæ§åˆ¶å°é¡¯ç¤ºã€Œæ‰¾åˆ°åœ–ç‰‡æ•¸: 0ã€
```
ğŸ¯ [åœ–ç‰‡åŠ è¼‰] æ‰¾åˆ°æ¨™æº–åœ–ç‰‡æ•¸: 0
ğŸ”„ [åœ–ç‰‡åŠ è¼‰] ä½¿ç”¨å‚™ç”¨é¸æ“‡å™¨ï¼Œæ‰¾åˆ°åœ–ç‰‡æ•¸: 0
```

**å¯èƒ½åŸå› **ï¼šMarkdown æ²’æœ‰æ­£ç¢ºè½‰æ›æˆ–å»¶é²ä¸è¶³
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. æª¢æŸ¥ `renderMarkdownWithImages` å‡½æ•¸æ˜¯å¦è¢«å‘¼å«
2. åœ¨æ§åˆ¶å°æ‰‹å‹•æŸ¥æ‰¾ï¼š
   ```javascript
   document.querySelectorAll('.rc-md-preview img')
   ```
3. å¦‚æœæœ‰åœ–ç‰‡ä½†æ²’æœ‰ `data-image-id`ï¼Œæª¢æŸ¥ `renderMarkdownWithImages` çš„ regex

### å•é¡Œ Cï¼šæ§åˆ¶å°é¡¯ç¤º API éŒ¯èª¤
```
âŒ [åœ–ç‰‡ 41] è¼‰å…¥å¤±æ•—: HTTP 404
```

**å¯èƒ½åŸå› **ï¼šåœ–ç‰‡ ID ä¸å­˜åœ¨æˆ– API è·¯å¾‘éŒ¯èª¤
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. æ¸¬è©¦ APIï¼š
   ```bash
   curl http://10.10.172.127/api/content-images/41/
   ```
2. ç¢ºèª ID æ˜¯å¦æ­£ç¢º
3. ä½¿ç”¨å·²çŸ¥å­˜åœ¨çš„ IDï¼ˆ32, 35, 36, 37, 38ï¼‰

### å•é¡Œ Dï¼šæ§åˆ¶å°é¡¯ç¤ºã€ŒNo data_url in responseã€
```
âŒ [åœ–ç‰‡ 41] è¼‰å…¥å¤±æ•—: Error: No data_url in response
```

**å¯èƒ½åŸå› **ï¼šAPI å›æ‡‰æ ¼å¼ä¸æ­£ç¢º
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. æª¢æŸ¥ API å›æ‡‰ï¼š
   ```bash
   curl -s http://10.10.172.127/api/content-images/41/ | jq
   ```
2. ç¢ºèªæœ‰ `data_url` æ¬„ä½

### å•é¡Œ Eï¼šåœ–ç‰‡ä»ç„¶é¡¯ç¤ºç‚ºåœ–æ¨™
å³ä½¿æ§åˆ¶å°é¡¯ç¤ºã€Œè¼‰å…¥æˆåŠŸã€ï¼Œé è¦½é¢æ¿ä»ç„¶æ˜¯åœ–æ¨™ã€‚

**å¯èƒ½åŸå› **ï¼šCSS è¦†è“‹æˆ– MdEditor é‡æ–°æ¸²æŸ“
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. åœ¨æ§åˆ¶å°æª¢æŸ¥åœ–ç‰‡å…ƒç´ ï¼š
   ```javascript
   const imgs = document.querySelectorAll('.rc-md-preview img');
   imgs.forEach(img => {
     console.log('Img src:', img.src);
     console.log('Img style:', img.style.cssText);
   });
   ```
2. ç¢ºèª `img.src` æ˜¯å¦ç‚º `data:image/...` æ ¼å¼
3. ç¢ºèªæ¨£å¼æ˜¯å¦è¢«è¦†è“‹

## ğŸ“Š æˆåŠŸæ¨™æº–

### âœ… å®Œå…¨æˆåŠŸ
- [ ] æ§åˆ¶å°æ²’æœ‰éŒ¯èª¤è¨Šæ¯
- [ ] æ‰€æœ‰åœ–ç‰‡æ—¥èªŒé¡¯ç¤ºã€Œâœ… è¼‰å…¥æˆåŠŸã€
- [ ] é è¦½é¢æ¿é¡¯ç¤ºå¯¦éš›åœ–ç‰‡ç¸®ç•¥åœ–
- [ ] åœ–ç‰‡æœ‰ç¶ è‰²é‚Šæ¡†
- [ ] åœ–ç‰‡å¤§å°ç´„ 100px å¯¬åº¦

### âš ï¸ éƒ¨åˆ†æˆåŠŸ
- [ ] æ§åˆ¶å°é¡¯ç¤ºã€Œâœ… è¼‰å…¥æˆåŠŸã€
- [ ] ä½†é è¦½é¢æ¿ä»æ˜¯åœ–æ¨™
- [ ] éœ€è¦é€²ä¸€æ­¥èª¿æŸ¥ CSS æˆ–æ¸²æŸ“å•é¡Œ

### âŒ å®Œå…¨å¤±æ•—
- [ ] æ§åˆ¶å°é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
- [ ] é è¦½é¢æ¿ä»æ˜¯åœ–æ¨™
- [ ] éœ€è¦æ ¹æ“šéŒ¯èª¤è¨Šæ¯é€²è¡Œå°æ‡‰è™•ç†

## ğŸ†˜ éœ€è¦å”åŠ©æ™‚

è«‹æä¾›ä»¥ä¸‹è³‡è¨Šï¼š

1. **æ§åˆ¶å°å®Œæ•´è¼¸å‡º**ï¼ˆæˆªåœ–æˆ–è¤‡è£½æ–‡å­—ï¼‰
2. **é è¦½é¢æ¿æˆªåœ–**
3. **æ¸¬è©¦ç”¨çš„åœ–ç‰‡ ID**
4. **ç€è¦½å™¨é¡å‹å’Œç‰ˆæœ¬**
5. **DOM æª¢æŸ¥çµæœ**ï¼š
   ```javascript
   // åœ¨æ§åˆ¶å°åŸ·è¡Œä¸¦æä¾›çµæœ
   const preview = document.querySelector('.rc-md-preview');
   const imgs = preview?.querySelectorAll('img');
   console.log('Preview found:', !!preview);
   console.log('Image count:', imgs?.length);
   imgs?.forEach((img, i) => {
     console.log(`Image ${i}:`, {
       src: img.src.substring(0, 50),
       dataId: img.getAttribute('data-image-id'),
       className: img.className,
       style: img.style.cssText
     });
   });
   ```

## ğŸ“ å‚™è¨»

- ç¢ºä¿ä½¿ç”¨çš„åœ–ç‰‡ ID å­˜åœ¨æ–¼è³‡æ–™åº«ä¸­
- å»ºè­°ä½¿ç”¨å·²çŸ¥çš„æ¸¬è©¦ IDï¼š32, 35, 36, 37, 38, 41, 42, 43, 44, 45
- å¦‚æœæŒçºŒå¤±æ•—ï¼Œå¯èƒ½éœ€è¦æª¢æŸ¥ MdEditor çš„æ¸²æŸ“æ©Ÿåˆ¶

---
**æ›´æ–°æ™‚é–“**: 2025-10-31  
**ç‰ˆæœ¬**: v1.1 - å¢å¼·é™¤éŒ¯å’Œå¤šé‡é¸æ“‡å™¨
