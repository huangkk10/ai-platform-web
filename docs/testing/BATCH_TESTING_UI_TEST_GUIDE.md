# 批量測試系統 - 前端 UI 測試指南

## 📋 測試概覽

**測試目標**：驗證批量測試系統的前端 UI 和 API 整合功能

**測試環境**：
- **前端 URL**：http://localhost/benchmark/batch-test
- **後端 API**：http://localhost/api/benchmark/versions/batch_test/
- **認證要求**：需要登入（staff 用戶）

**測試時間**：預計 15-20 分鐘

---

## 🎯 測試前準備

### 1. 確認系統狀態

```bash
# 檢查容器狀態
docker compose ps

# 應該看到以下容器運行中：
# - ai-django (Django 後端)
# - ai-react (React 前端)
# - postgres_db (PostgreSQL 資料庫)
# - ai-nginx (Nginx 反向代理)
```

### 2. 確認資料準備

```bash
# 檢查版本數量
docker exec postgres_db psql -U postgres -d ai_platform -c \
  "SELECT COUNT(*) as version_count FROM search_algorithm_version;"

# 檢查測試案例數量
docker exec postgres_db psql -U postgres -d ai_platform -c \
  "SELECT COUNT(*) as testcase_count FROM benchmark_test_case WHERE is_active = true;"
```

**預期結果**：
- 至少有 3 個版本
- 至少有 2 個啟用的測試案例

### 3. 準備測試用戶

**可用的 staff 用戶**（根據資料庫查詢結果）：
- `Eric_huang`
- `EdwardFu`
- `admin_test`

**密碼**：請使用實際設定的密碼

---

## 🧪 測試案例

### 測試案例 1：頁面載入與版本選擇

**步驟**：
1. 打開瀏覽器，訪問 http://localhost
2. 使用 staff 用戶登入（例如：Eric_huang）
3. 從側邊欄點擊 **Benchmark** → **Batch Test**
4. 等待頁面完全載入

**驗證點**：
- ✅ 頁面標題顯示「批量測試執行」
- ✅ 版本列表正確載入（顯示版本名稱和卡片）
- ✅ 所有版本預設為選中狀態（checkbox 勾選）
- ✅ 右側顯示「測試估算」卡片

**預期畫面**：
```
批量測試執行
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

選擇測試版本
┌─────────────────────────────────────────────┐
│ ☑ 全選  ☐ 只選新版本  🔄 重新載入           │
├─────────────────────────────────────────────┤
│ ☑ Baseline Version                          │
│ ☑ Baseline Test                             │
│ ☑ V1 - 純段落向量搜尋 🎯                    │
│ ☑ V2 - 純全文向量搜尋 📚                    │
│ ... (更多版本)                               │
└─────────────────────────────────────────────┘

測試估算
┌─────────────────────────────────────────────┐
│ 選擇版本數：7                                │
│ 測試案例數：2                                │
│ 總測試次數：14                               │
│ 預計時間：約 1 分鐘                          │
└─────────────────────────────────────────────┘
```

**操作測試**：
- 點擊「全選」按鈕：所有版本應該被選中
- 再次點擊：所有版本應該被取消選中
- 手動勾選/取消勾選個別版本：統計數字應即時更新

---

### 測試案例 2：測試案例選擇

**步驟**：
1. 滾動到「選擇測試案例」區塊
2. 查看測試案例模式選項

**驗證點**：
- ✅ 顯示兩個模式選項：「使用所有案例」和「自訂選擇」
- ✅ 預設選擇「使用所有案例」
- ✅ 顯示測試案例統計（總數、分類、難度分布）

**操作測試**：
1. 選擇「自訂選擇」模式
   - ✅ 出現篩選器（類別、難度、數量限制）
2. 嘗試設定數量限制為 5
   - ✅ 測試估算的「測試案例數」更新為 5
   - ✅ 總測試次數相應更新

**預期畫面**：
```
選擇測試案例
┌─────────────────────────────────────────────┐
│ ⦿ 使用所有案例  ○ 自訂選擇                  │
├─────────────────────────────────────────────┤
│ 📊 測試案例統計                              │
│ • 總數：50 個案例                            │
│ • 啟用：48 個案例                            │
│ • 分類：ULINK (20), 其他 (28)               │
│ • 難度：簡單 (15), 中等 (25), 困難 (8)     │
└─────────────────────────────────────────────┘
```

---

### 測試案例 3：執行批量測試（關鍵測試）

**步驟**：
1. 選擇 2-3 個版本（例如：Baseline Version, Baseline Test, V1）
2. 使用「使用所有案例」模式（或限制為 2 個案例以加快測試）
3. 確認「強制重新測試」checkbox 未勾選
4. 點擊「🚀 執行批量測試」按鈕

**驗證點**：
- ✅ 按鈕變為載入狀態（顯示 Spin 圖示）
- ✅ 按鈕文字變為「執行中...」
- ✅ 按鈕被禁用，無法再次點擊
- ✅ 等待期間不會崩潰或報錯

**預期行為**：
```
點擊前：
┌────────────────────────────────────┐
│  🚀 執行批量測試                    │
└────────────────────────────────────┘

點擊後：
┌────────────────────────────────────┐
│  ⏳ 執行中...                       │
└────────────────────────────────────┘
```

**執行時間**：
- 2-3 個版本 × 2 個案例 = 4-6 次測試
- 預計時間：10-20 秒

---

### 測試案例 4：API 回應處理

**步驟**：
1. 測試執行完成後（參考測試案例 3）
2. 觀察系統行為

**成功情境驗證**：
- ✅ 顯示成功訊息（Ant Design message.success）
- ✅ 訊息內容類似：「批量測試完成！測試了 2 個版本」
- ✅ 自動跳轉到對比頁面：`/benchmark/comparison/{batchId}`

**失敗情境驗證**（如果發生）：
- ✅ 顯示錯誤訊息（message.error）
- ✅ 按鈕恢復可點擊狀態
- ✅ 錯誤訊息清晰描述問題

**瀏覽器開發者工具檢查**：
1. 打開 Chrome DevTools (F12)
2. 切換到 **Network** 標籤
3. 執行測試，觀察 API 請求

**預期網絡請求**：
```
POST /api/benchmark/versions/batch_test/
Request Payload:
{
  "version_ids": [3, 4, 5],
  "test_case_ids": [],  // 空陣列表示使用所有案例
  "batch_name": "批量測試 2025-11-23 16:30:45",
  "notes": "",
  "force_retest": false
}

Response (Status: 201 Created):
{
  "success": true,
  "batch_id": "20251123_163045",
  "batch_name": "批量測試 2025-11-23 16:30:45",
  "test_run_ids": [42, 43, 44],
  "comparison": {
    "versions": [...],
    "ranking": {...},
    "best_version": {...}
  },
  "summary": {
    "total_versions_tested": 3,
    "total_test_cases": 2,
    "total_tests_executed": 6,
    "execution_time": 18.5
  }
}
```

---

### 測試案例 5：對比頁面跳轉與顯示

**步驟**：
1. 測試完成後自動跳轉到對比頁面
2. URL 應該是：`/benchmark/comparison/{batchId}`

**驗證點**：
- ✅ 頁面成功載入，無 404 錯誤
- ✅ 頁面標題顯示「批量測試對比報告」
- ✅ 顯示批次資訊（批次 ID、測試時間）

**目前狀態**：
⚠️ **注意**：對比頁面目前使用 mock 資料，所以：
- 顯示的資料可能不是剛才測試的實際結果
- 這是正常的，因為任務 12 才會整合真實 API

**預期畫面**（mock 資料）：
```
批量測試對比報告
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🏆 最佳版本
┌─────────────────────────────────────────────┐
│ V3 - 混合權重 70-30 ⭐                      │
│ 總分：85.5                                   │
│ 精準度：88.2% | 召回率：82.8%                │
└─────────────────────────────────────────────┘

📊 詳細對比
┌───────────────────────────────────────────────────┐
│ 版本名稱          │ 總分  │ 精準度 │ 召回率 │ ... │
├───────────────────────────────────────────────────┤
│ V3 - 混合 70-30  │ 85.5  │ 88.2%  │ 82.8%  │ ... │
│ V5 - 混合 80-20  │ 84.3  │ 90.1%  │ 78.5%  │ ... │
│ ...              │ ...   │ ...    │ ...    │ ... │
└───────────────────────────────────────────────────┘
```

---

### 測試案例 6：錯誤處理測試

**場景 A：未選擇任何版本**

**步驟**：
1. 取消選擇所有版本（全選 → 取消全選）
2. 點擊「執行批量測試」

**預期行為**：
- ✅ 顯示警告訊息：「請至少選擇一個版本」
- ✅ 不發送 API 請求
- ✅ 按鈕保持可用狀態

**場景 B：網絡錯誤**

**測試方法**（需要 DevTools）：
1. 打開 Chrome DevTools (F12)
2. 切換到 **Network** 標籤
3. 勾選「Offline」（模擬離線）
4. 點擊「執行批量測試」

**預期行為**：
- ✅ 顯示錯誤訊息：「批量測試失敗」或「網絡錯誤」
- ✅ 按鈕恢復可點擊狀態
- ✅ 不會跳轉頁面

---

## 🐛 常見問題與排除

### 問題 1：頁面無法訪問（404 Not Found）

**症狀**：訪問 http://localhost/benchmark/batch-test 出現 404

**可能原因**：
1. React 容器未正確重啟
2. 路由配置未載入

**解決方案**：
```bash
# 重啟 React 容器
cd /home/user/codes/ai-platform-web
docker compose restart react

# 等待 30 秒後重試
sleep 30
```

### 問題 2：API 返回 403 Forbidden

**症狀**：點擊「執行批量測試」後顯示「權限不足」或 403 錯誤

**可能原因**：
1. 未登入
2. 登入用戶不是 staff

**解決方案**：
1. 確認已登入系統
2. 使用 staff 用戶登入（Eric_huang, EdwardFu, admin_test）
3. 檢查瀏覽器 Cookies 中是否有 sessionid

### 問題 3：API 返回 500 Internal Server Error

**症狀**：測試執行失敗，返回 500 錯誤

**排查步驟**：
```bash
# 1. 查看 Django 日誌
docker logs ai-django --tail 100

# 2. 檢查容器內檔案是否最新
docker exec ai-django grep -n "def batch_test" /app/api/views/viewsets/benchmark_viewsets.py

# 3. 檢查 batch_version_tester.py 是否存在
docker exec ai-django ls -la /app/library/benchmark/batch_version_tester.py

# 4. 重啟 Django 容器
docker compose restart django
```

### 問題 4：測試執行時間過長（超過 1 分鐘）

**可能原因**：
1. 選擇了過多的版本或測試案例
2. 向量搜尋效能問題

**建議**：
1. 首次測試建議只選擇 2-3 個版本
2. 限制測試案例數量為 2-5 個
3. 檢查資料庫連接是否正常

### 問題 5：對比頁面顯示 mock 資料而非實際結果

**說明**：這是預期行為！

**原因**：
- 對比頁面目前使用 `generateMockComparisonData()` 函數生成資料
- 任務 12 才會整合真實 API

**驗證方法**：
- 打開 `/frontend/src/pages/benchmark/BatchComparisonPage.js`
- 搜尋 `generateMockComparisonData`
- 確認該函數被調用

---

## ✅ 測試檢查清單

複製以下清單，逐項測試並勾選：

### 基本功能測試
- [ ] 頁面可以正常訪問（無 404 錯誤）
- [ ] 版本列表正確載入
- [ ] 測試案例統計正確顯示
- [ ] 全選/取消全選功能正常
- [ ] 手動勾選版本時統計即時更新

### 測試執行測試
- [ ] 點擊「執行批量測試」按鈕有反應
- [ ] 按鈕顯示載入狀態
- [ ] API 請求成功發送（狀態碼 201）
- [ ] 測試在合理時間內完成（< 30 秒）
- [ ] 顯示成功訊息

### 頁面跳轉測試
- [ ] 成功後自動跳轉到對比頁面
- [ ] 對比頁面 URL 包含 batch ID
- [ ] 對比頁面正常載入（目前顯示 mock 資料）

### 錯誤處理測試
- [ ] 未選擇版本時顯示警告
- [ ] 網絡錯誤時顯示錯誤訊息
- [ ] 權限不足時顯示 403 錯誤

### UI/UX 測試
- [ ] 頁面樣式正常（使用 Ant Design）
- [ ] 響應式設計正常（嘗試調整瀏覽器寬度）
- [ ] 所有按鈕和互動元素可點擊
- [ ] Loading 狀態清晰可見

---

## 📊 測試報告模板

測試完成後，請填寫以下報告：

```markdown
## 批量測試系統 - 前端測試報告

**測試日期**：2025-11-23
**測試人員**：[您的名字]
**測試環境**：Chrome / Firefox / Safari (請選擇)
**測試時長**：[實際測試時間]

### 測試結果摘要
- ✅ 通過的測試案例：[ ] / 6
- ❌ 失敗的測試案例：[ ] / 6
- ⚠️ 發現的問題：[ ] 個

### 詳細測試結果

#### 測試案例 1：頁面載入與版本選擇
- 狀態：✅ 通過 / ❌ 失敗
- 備註：[如有問題請說明]

#### 測試案例 2：測試案例選擇
- 狀態：✅ 通過 / ❌ 失敗
- 備註：

#### 測試案例 3：執行批量測試
- 狀態：✅ 通過 / ❌ 失敗
- 執行時間：[秒]
- 備註：

#### 測試案例 4：API 回應處理
- 狀態：✅ 通過 / ❌ 失敗
- API 狀態碼：[200/201/403/500]
- 備註：

#### 測試案例 5：對比頁面跳轉與顯示
- 狀態：✅ 通過 / ❌ 失敗
- 備註：

#### 測試案例 6：錯誤處理測試
- 狀態：✅ 通過 / ❌ 失敗
- 備註：

### 發現的問題
1. [問題描述]
   - 嚴重程度：高/中/低
   - 重現步驟：
   - 預期行為：
   - 實際行為：

### 建議改進
1. [改進建議]

### 總體評價
[整體測試感受和建議]
```

---

## 🚀 下一步

測試完成後：

1. **如果所有測試通過**：
   - 標記任務 11 為完成 ✅
   - 進入任務 12：整合真實 API 到對比頁面

2. **如果發現問題**：
   - 記錄詳細的錯誤訊息
   - 檢查瀏覽器 Console 的錯誤日誌
   - 查看 Django 容器日誌
   - 根據「常見問題與排除」進行故障排除

---

**祝測試順利！有任何問題請隨時回報。** 🎉
