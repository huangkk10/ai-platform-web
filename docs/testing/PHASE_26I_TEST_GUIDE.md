# Phase 26i 測試指南

**測試時間**: 2025-11-23  
**測試內容**: Pass Rate 修復 + Test Cases 列表頁面

---

## 🎯 測試目標

1. ✅ 驗證 Pass Rate 百分比顯示已修復（不再顯示 9818%）
2. ✅ 驗證 Test Cases 頁面可正常訪問和運作

---

## 📋 測試前準備

### 1. 確認登入狀態
- **必須使用 Staff 管理員帳號登入**
- 確認左側選單顯示 "Benchmark 測試" 選項

### 2. 確認容器狀態
```bash
# 檢查容器運行狀態
docker compose ps

# 確認以下容器都是 Up 狀態：
# - ai-django (Django backend)
# - ai-react (React frontend)
```

---

## 🧪 測試步驟

### 測試 1: Pass Rate 顯示修復 ✅

**測試目的**: 驗證通過率不再顯示異常的 9818% 之類的數值

**步驟**:
1. 進入 **Batch History** 頁面
   - 路徑: Benchmark 測試 → Batch History

2. 點擊任一批次測試的「查看對比」按鈕
   - 會跳轉到 Batch Comparison 頁面

3. 查看「版本對比總覽」表格的 **Pass Rate** 欄位

**預期結果**:
- ✅ Pass Rate 顯示為正常的百分比（0% - 100%）
- ✅ 例如: `98.2%`、`96.4%` 等
- ❌ **不應該**顯示: `9818%`、`10000%` 等異常值

**範例數值**:
```
V1: Pass Rate = 98.18% ✅
V2: Pass Rate = 96.36% ✅
V3: Pass Rate = 94.55% ✅
V4: Pass Rate = 96.36% ✅
V5: Pass Rate = 98.18% ✅
```

---

### 測試 2: Test Cases 頁面訪問 ✅

**測試目的**: 驗證新的 Test Cases 頁面可正常訪問

**步驟**:
1. 點擊左側選單 **「Benchmark 測試」**
2. 在展開的子選單中點擊 **「Test Cases」**

**預期結果**:
- ✅ 頁面成功載入
- ✅ 頁面標題顯示「測試案例管理」
- ✅ 不出現紅色錯誤訊息（"Uncaught runtime errors"）

**如果出現錯誤**:
- 檢查是否已登入
- 檢查是否有 Staff 權限
- 重新整理頁面 (F5)

---

### 測試 3: 統計卡片顯示 ✅

**測試目的**: 驗證統計資料正確顯示

**在 Test Cases 頁面頂部應該看到 4 個統計卡片**:

| 卡片 | 說明 | 預期 |
|------|------|------|
| 📊 Total Cases | 總測試案例數 | 顯示數字（如 55） |
| 📁 Categories | 測試分類數量 | 顯示數字（如 3） |
| ✅ Easy Cases | 簡單難度案例數 | 顯示數字（如 20） |
| 🔥 Hard Cases | 困難難度案例數 | 顯示數字（如 15） |

**預期結果**:
- ✅ 所有卡片都顯示數字
- ✅ 數字加總合理（Easy + Medium + Hard ≈ Total）

---

### 測試 4: 表格資料顯示 ✅

**測試目的**: 驗證測試案例表格正確顯示資料

**檢查表格欄位**:
1. **ID**: 測試案例編號
2. **Question**: 問題內容（應顯示文字）
3. **Category**: 分類（如 Protocol、RVT 等）
4. **Difficulty**: 難度標籤（綠色 Easy / 橙色 Medium / 紅色 Hard）
5. **Question Type**: 問題類型
6. **Expected Doc Count**: 期望文檔數
7. **Min Matches**: 最小匹配數
8. **Status**: 啟用狀態（綠色勾勾 / 紅色叉叉）
9. **Actions**: 「查看」按鈕

**預期結果**:
- ✅ 表格至少顯示一些測試案例
- ✅ 所有欄位都有資料
- ✅ 難度標籤有顏色（Easy=綠、Medium=橙、Hard=紅）

---

### 測試 5: 搜尋功能 ✅

**測試目的**: 驗證搜尋框可正常過濾資料

**步驟**:
1. 在「搜尋問題內容」輸入框中輸入關鍵字
   - 範例關鍵字: `I3C`、`protocol`、`test`

2. 觀察表格資料變化

**預期結果**:
- ✅ 表格即時過濾（不需要按搜尋按鈕）
- ✅ 只顯示問題內容包含關鍵字的案例
- ✅ 統計卡片的數字**不會**改變（顯示全部資料統計）

---

### 測試 6: 難度過濾 ✅

**測試目的**: 驗證難度下拉選單過濾功能

**步驟**:
1. 點擊「Difficulty」下拉選單
2. 選擇 **Hard**

**預期結果**:
- ✅ 表格只顯示 Hard 難度的測試案例
- ✅ 所有案例的 Difficulty 欄位都顯示紅色的 "Hard" 標籤
- ✅ 可以切換回 "All" 顯示全部

---

### 測試 7: 分類過濾 ✅

**測試目的**: 驗證分類下拉選單過濾功能

**步驟**:
1. 點擊「Category」下拉選單
2. 選擇任一分類（如 "Protocol"）

**預期結果**:
- ✅ 表格只顯示該分類的測試案例
- ✅ 所有案例的 Category 欄位都是選擇的分類
- ✅ 可以切換回 "All" 顯示全部

---

### 測試 8: 詳情查看 ✅

**測試目的**: 驗證詳情模態框可正常顯示

**步驟**:
1. 點擊任一測試案例的「查看」按鈕
2. 檢查彈出的模態框內容

**預期結果**:
- ✅ 彈出模態框
- ✅ 標題顯示「測試案例詳情」
- ✅ 顯示完整的測試案例資訊：
  - 測試案例 ID
  - 問題內容
  - 測試分類
  - 難度等級
  - 問題類型
  - 知識源
  - 期望文檔數量
  - 最小匹配數
  - 啟用狀態
  - 建立時間
- ✅ 可以點擊「關閉」按鈕關閉模態框

---

### 測試 9: 分頁功能 ✅

**測試目的**: 驗證分頁控制正常運作

**步驟**:
1. 滾動到表格底部
2. 檢查分頁控制
3. 點擊「每頁顯示」下拉選單
4. 切換不同的每頁數量（10 / 20 / 50 / 100）

**預期結果**:
- ✅ 顯示總數（如「第 1-20 項，共 55 項」）
- ✅ 可以切換每頁顯示數量
- ✅ 表格資料根據選擇的數量更新
- ✅ 可以跳轉到不同頁面

---

### 測試 10: 重新整理功能 ✅

**測試目的**: 驗證重新整理按鈕可正常運作

**步驟**:
1. 點擊頁面右上角的「重新整理」按鈕

**預期結果**:
- ✅ 出現 Loading 狀態
- ✅ 資料重新載入
- ✅ 顯示成功訊息（如「成功載入 55 個測試案例」）

---

## 🚨 常見問題排解

### 問題 1: 頁面顯示「Authentication credentials were not provided」

**原因**: 未登入或 session 過期

**解決方案**:
1. 重新登入系統
2. 確認使用 Staff 管理員帳號
3. 重新整理頁面 (F5)

---

### 問題 2: 頁面顯示「rawData.some is not a function」

**原因**: API 返回資料格式不正確

**解決方案**:
1. 檢查 Django 容器日誌:
   ```bash
   docker logs ai-django --tail 50
   ```
2. 檢查 React 容器日誌:
   ```bash
   docker logs ai-react --tail 50
   ```
3. 重啟容器:
   ```bash
   docker compose restart django react
   ```

---

### 問題 3: 統計卡片顯示 0

**可能原因**: 資料庫沒有測試案例

**檢查方法**:
```bash
docker exec postgres_db psql -U postgres -d ai_platform -c "
SELECT COUNT(*) as total_cases FROM benchmark_test_case;
"
```

**如果數量為 0**:
- 需要先創建測試案例
- 或匯入測試資料

---

### 問題 4: Pass Rate 還是顯示異常數值

**可能原因**: Django 容器沒有重啟或程式碼沒有更新

**解決方案**:
1. 確認 Django 容器已重啟:
   ```bash
   docker compose restart django
   ```

2. 驗證程式碼已更新:
   ```bash
   docker exec ai-django grep -A 3 "def get_pass_rate" /app/api/serializers.py | grep "return round"
   ```
   
   **應該看到**: `return round(passed / total, 4)`  
   **而不是**: `return round((passed / total) * 100, 2)`

3. 清除瀏覽器快取並重新整理 (Ctrl+Shift+R)

---

## ✅ 測試檢查清單

完成以下所有測試項目後，可以確認 Phase 26i 功能正常：

### Pass Rate 修復
- [ ] Batch Comparison 頁面 Pass Rate 顯示正常（0-100%）
- [ ] 所有版本的 Pass Rate 都在合理範圍內
- [ ] 與 Precision、Recall、F1 顯示格式一致

### Test Cases 頁面
- [ ] 頁面可正常訪問（無紅色錯誤）
- [ ] 統計卡片顯示正確數字
- [ ] 表格顯示測試案例資料
- [ ] 搜尋功能正常運作
- [ ] 難度過濾正常運作
- [ ] 分類過濾正常運作
- [ ] 詳情模態框可正常開啟和關閉
- [ ] 分頁功能正常運作
- [ ] 重新整理按鈕正常運作

---

## 📊 測試報告範本

**測試日期**: _____________________  
**測試人員**: _____________________  
**測試環境**: http://10.10.172.127

### Pass Rate 修復測試結果
- [ ] ✅ 通過
- [ ] ❌ 失敗 - 問題描述: ___________________________

### Test Cases 頁面測試結果
- [ ] ✅ 完全正常
- [ ] ⚠️ 部分功能有問題 - 詳述: ___________________________
- [ ] ❌ 無法使用 - 錯誤訊息: ___________________________

### 額外發現的問題
_______________________________________________
_______________________________________________
_______________________________________________

---

**測試完成！** 🎉

如果所有測試都通過，Phase 26i 功能開發完成，可以進入下一階段。
