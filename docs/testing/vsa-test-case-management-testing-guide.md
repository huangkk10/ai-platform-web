# VSA 測試案例管理 - 功能測試指南

## 📋 概述
本文檔說明如何測試「VSA 測試案例管理」的新增/編輯功能。

## 🎯 測試環境
- **URL**: http://localhost:3000 或 http://10.10.172.127
- **頁面路徑**: `/dify-benchmark/test-cases`（側邊欄：「Testing Tools」→「Unified Test Cases」）
- **需要權限**: 已登入用戶

## ✅ 測試清單

### 1. 新增測試案例功能

#### 步驟 1：開啟新增 Modal
- [ ] 點擊頁面右上角的「新增測試案例」按鈕
- [ ] Modal 視窗正常彈出
- [ ] Modal 標題顯示「新增測試案例」
- [ ] Modal 寬度適中（900px）

#### 步驟 2：檢查表單欄位
- [ ] **基本資訊區塊**顯示正確
  - [ ] 測試問題欄位（必填，4 行文字框）
  - [ ] 難度等級下拉選單（預設為「中等」）
  - [ ] 類別下拉選單（可輸入新類別）

- [ ] **VSA 測試配置區塊**顯示正確
  - [ ] 期望答案欄位（必填，6 行文字框）
  - [ ] 答案關鍵字欄位（多行輸入，每行一個關鍵字）
  - [ ] 滿分欄位（預設為 100）

- [ ] **進階選項區塊**顯示正確
  - [ ] 測試類別欄位
  - [ ] 問題類型欄位
  - [ ] 標籤欄位（多標籤輸入）
  - [ ] 來源欄位
  - [ ] 備註欄位（3 行文字框）
  - [ ] 狀態下拉選單（預設為「啟用」）

#### 步驟 3：測試必填欄位驗證
- [ ] 不填任何欄位，直接點擊「儲存」
- [ ] 系統應顯示錯誤提示「請輸入測試問題」
- [ ] 填寫測試問題，但不填期望答案
- [ ] 系統應顯示錯誤提示「請輸入期望答案」
- [ ] 填寫測試問題和期望答案，但不選擇類別
- [ ] 系統應顯示錯誤提示「請輸入類別」

#### 步驟 4：測試完整新增流程
填寫以下測試資料：

**基本資訊**：
- 測試問題: `請問如何在 Kingston Linux 葉卡上執行 USB 測試？`
- 難度等級: `中等`
- 類別: `Kingston`

**VSA 測試配置**：
- 期望答案:
  ```
  在 Kingston Linux 葉卡上執行 USB 測試的步驟：
  1. 插入 USB 設備
  2. 使用 lsusb 命令檢查設備是否被識別
  3. 執行測試腳本進行讀寫測試
  4. 查看測試結果報告
  ```
- 答案關鍵字（每行一個）:
  ```
  Kingston
  USB
  Linux
  葉卡
  lsusb
  測試腳本
  ```
- 滿分: `100`

**進階選項**：
- 測試類別: `USB測試`
- 問題類型: `測試流程`
- 標籤: `Kingston, Linux, USB, 葉卡`
- 來源: `實際測試案例`
- 備註: `這是一個常見的 USB 測試問題`
- 狀態: `啟用`

**驗證**：
- [ ] 點擊「儲存」按鈕
- [ ] 看到「測試案例新增成功」的成功訊息
- [ ] Modal 自動關閉
- [ ] 表格自動刷新，新案例出現在列表中
- [ ] 檢查新案例的所有欄位是否正確顯示

### 2. 編輯測試案例功能

#### 步驟 1：開啟編輯 Modal
- [ ] 在測試案例列表中，點擊任一案例的「編輯」按鈕（鉛筆圖標）
- [ ] Modal 視窗正常彈出
- [ ] Modal 標題顯示「編輯測試案例」
- [ ] 所有欄位正確載入原有資料

#### 步驟 2：檢查資料格式轉換
- [ ] 答案關鍵字正確顯示為多行文字（每行一個關鍵字）
- [ ] 標籤正確顯示為標籤列表
- [ ] 類別正確顯示
- [ ] 滿分正確顯示為數字

#### 步驟 3：測試編輯功能
- [ ] 修改測試問題
- [ ] 修改期望答案
- [ ] 添加新的答案關鍵字（在末尾添加一行 `新關鍵字`）
- [ ] 修改難度等級
- [ ] 點擊「儲存」
- [ ] 看到「測試案例更新成功」的成功訊息
- [ ] Modal 自動關閉
- [ ] 表格自動刷新，修改的內容正確顯示

### 3. 資料格式轉換測試

#### 測試案例 1：答案關鍵字格式
**輸入**（多行文字）:
```
Kingston
USB
Linux

葉卡
lsusb
```

**預期後端收到的資料**:
```json
{
  "answer_keywords": ["Kingston", "USB", "Linux", "葉卡", "lsusb"]
}
```

**驗證方式**：
- [ ] 在瀏覽器開發者工具的 Network 面板查看 POST/PUT 請求
- [ ] 確認 `answer_keywords` 是陣列格式
- [ ] 確認空行已被過濾

#### 測試案例 2：標籤格式
**輸入**（標籤輸入框）:
```
Kingston, Linux, USB, 葉卡
```

**預期後端收到的資料**:
```json
{
  "tags": ["Kingston", "Linux", "USB", "葉卡"]
}
```

**驗證方式**：
- [ ] 在 Network 面板查看請求
- [ ] 確認 `tags` 是陣列格式

#### 測試案例 3：類別格式
**輸入**（選擇或輸入新類別）:
```
Kingston
```

**預期後端收到的資料**:
```json
{
  "category": "Kingston"
}
```

**驗證方式**：
- [ ] 確認 `category` 是字串而非陣列

### 4. 邊界條件測試

#### 測試 1：空值處理
- [ ] 答案關鍵字欄位留空
- [ ] 標籤欄位留空
- [ ] 進階選項全部留空
- [ ] 應該可以正常提交
- [ ] 後端應接收到空陣列 `[]` 或空字串

#### 測試 2：特殊字元
- [ ] 在測試問題中輸入特殊字元：`<>'"&`
- [ ] 在答案關鍵字中輸入特殊字元
- [ ] 應該可以正常儲存和顯示

#### 測試 3：長文本
- [ ] 輸入接近字元限制的長文本
- [ ] 測試問題：990 字元（限制 1000）
- [ ] 期望答案：1990 字元（限制 2000）
- [ ] 應該可以正常儲存

### 5. UI/UX 測試

#### 視覺效果
- [ ] Modal 寬度合適（900px）
- [ ] 區塊分隔清晰（Divider 顯示正確）
- [ ] 字體大小和顏色適中
- [ ] Tooltip 提示資訊顯示正確

#### 互動體驗
- [ ] 必填欄位有紅色 * 標記
- [ ] 游標移到欄位標籤，Tooltip 正常顯示
- [ ] 文字框字元計數器正常工作
- [ ] 下拉選單選項正確
- [ ] 標籤輸入支援逗號分隔和 Enter 鍵

#### 載入狀態
- [ ] 點擊「儲存」後，按鈕顯示載入中狀態
- [ ] 提交期間無法重複點擊按鈕
- [ ] 提交完成後按鈕恢復正常

### 6. 錯誤處理測試

#### 網路錯誤
- [ ] 關閉後端服務
- [ ] 嘗試新增測試案例
- [ ] 應顯示友善的錯誤訊息

#### 後端驗證錯誤
- [ ] 嘗試提交不符合後端驗證規則的資料
- [ ] 應顯示後端返回的錯誤訊息

## 🔍 除錯技巧

### 查看提交的資料
在瀏覽器開發者工具的 Console 面板，應該可以看到：
```
準備提交的資料: {
  question: "...",
  expected_answer: "...",
  answer_keywords: ["...", "..."],
  tags: ["...", "..."],
  category: "...",
  ...
}
```

### 查看網路請求
在 Network 面板中：
1. 篩選 XHR/Fetch 請求
2. 找到 `/api/dify-benchmark/test-cases/` 的 POST 或 PUT 請求
3. 查看 Request Payload
4. 查看 Response

### 查看後端日誌
```bash
docker logs ai-django --tail 100 --follow
```

## ✅ 測試完成標準

- [ ] 所有必填欄位驗證正常工作
- [ ] 新增功能完整可用
- [ ] 編輯功能正確載入和更新資料
- [ ] 資料格式轉換正確（特別是陣列欄位）
- [ ] UI/UX 體驗良好
- [ ] 錯誤處理友善
- [ ] 無 Console 錯誤或警告

## 📝 測試記錄

| 測試項目 | 狀態 | 測試時間 | 測試者 | 備註 |
|---------|------|---------|--------|------|
| 新增功能 | ⬜ 未測試 / ✅ 通過 / ❌ 失敗 | | | |
| 編輯功能 | ⬜ 未測試 / ✅ 通過 / ❌ 失敗 | | | |
| 資料格式轉換 | ⬜ 未測試 / ✅ 通過 / ❌ 失敗 | | | |
| 邊界條件 | ⬜ 未測試 / ✅ 通過 / ❌ 失敗 | | | |
| UI/UX | ⬜ 未測試 / ✅ 通過 / ❌ 失敗 | | | |
| 錯誤處理 | ⬜ 未測試 / ✅ 通過 / ❌ 失敗 | | | |

## 🐛 已知問題

（測試後記錄發現的問題）

---

**文檔版本**: v1.0  
**創建日期**: 2025-11-27  
**最後更新**: 2025-11-27
