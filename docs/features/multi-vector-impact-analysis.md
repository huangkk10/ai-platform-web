# æ–¹æ¡ˆ Aï¼šå¤šå‘é‡æ–¹æ³•å½±éŸ¿åˆ†æå ±å‘Š

**åˆ†ææ—¥æœŸ**ï¼š2025-11-06  
**åˆ†æè€…**ï¼šAI Assistant  
**ç›®çš„**ï¼šè©•ä¼°å¯¦æ–½ã€Œæ¨™é¡Œ/å…§å®¹åˆ†é–‹è¨ˆç®—å‘é‡åˆ†æ•¸ã€å°ç¾æœ‰ç³»çµ±çš„å½±éŸ¿ç¯„åœ

---

## ğŸ“‹ åŸ·è¡Œæ‘˜è¦

### â“ å•é¡Œ
æ˜¯å¦ä½¿ç”¨**æ–¹æ¡ˆ Aï¼ˆå¤šå‘é‡æ–¹æ³•ï¼‰**ä¿®æ”¹æœƒé€£åŒ RVT Assistant ä¹Ÿä¸€ä½µä¿®æ”¹ï¼Ÿ

### âœ… ç­”æ¡ˆ
**æ˜¯çš„ï¼Œæœƒå½±éŸ¿åˆ° RVT Assistant å’Œæ‰€æœ‰ä½¿ç”¨ `BaseKnowledgeBaseVectorService` çš„ Assistantã€‚**

---

## ğŸ¯ å½±éŸ¿ç¯„åœåˆ†æ

### 1. **å…±ç”¨åŸºç¤æ¶æ§‹**

æ‰€æœ‰ Assistant éƒ½ä½¿ç”¨çµ±ä¸€çš„åŸºç¤é¡åˆ¥ï¼š

```python
# åŸºç¤é¡åˆ¥ï¼ˆå…±ç”¨æ¶æ§‹ï¼‰
library/common/knowledge_base/
â”œâ”€â”€ base_vector_service.py         # å‘é‡æœå‹™åŸºç¤é¡åˆ¥
â”œâ”€â”€ base_search_service.py         # æœç´¢æœå‹™åŸºç¤é¡åˆ¥
â””â”€â”€ vector_search_helper.py        # é€šç”¨å‘é‡æœç´¢åŠ©æ‰‹
```

### 2. **å—å½±éŸ¿çš„ Assistant**

æ ¹æ“šä»£ç¢¼åˆ†æï¼Œç›®å‰æœ‰ **2 å€‹ Assistant** ä½¿ç”¨æ­¤æ¶æ§‹ï¼š

| Assistant | Vector Service | Search Service | ä½¿ç”¨åŸºç¤é¡åˆ¥ |
|-----------|---------------|----------------|-------------|
| **Protocol Assistant** | `ProtocolGuideVectorService` | `ProtocolGuideSearchService` | âœ… æ˜¯ |
| **RVT Assistant** | `RVTGuideVectorService` | `RVTGuideSearchService` | âœ… æ˜¯ |

### 3. **å…±ç”¨çš„å‘é‡è¡¨**

å…©å€‹ Assistant å…±ç”¨åŒä¸€å€‹å‘é‡è³‡æ–™åº«è¡¨ï¼š

```sql
-- ç•¶å‰è³‡æ–™åˆ†å¸ƒ
SELECT source_table, COUNT(*) FROM document_embeddings GROUP BY source_table;

  source_table  | count 
----------------+-------
 protocol_guide |     5
 rvt_guide      |     2
```

**é—œéµç™¼ç¾**ï¼š
- âœ… ä½¿ç”¨çµ±ä¸€çš„ `document_embeddings` è¡¨
- âœ… ç›®å‰åªæœ‰ä¸€å€‹ `embedding vector(1024)` æ¬„ä½
- âœ… é€é `source_table` æ¬„ä½å€åˆ†ä¸åŒ Assistant

---

## ğŸ”„ æ–¹æ¡ˆ A å¯¦æ–½æœƒå½±éŸ¿çš„å±¤é¢

### å±¤é¢ 1ï¼šè³‡æ–™åº«çµæ§‹è®Šæ›´ âš ï¸ **æœƒå½±éŸ¿å…¨éƒ¨**

**ç•¶å‰çµæ§‹**ï¼š
```sql
CREATE TABLE document_embeddings (
    id SERIAL PRIMARY KEY,
    source_table VARCHAR(100) NOT NULL,
    source_id INTEGER NOT NULL,
    text_content TEXT,
    content_hash VARCHAR(64),
    embedding vector(1024),  -- âš ï¸ åªæœ‰ä¸€å€‹å‘é‡
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

**æ–¹æ¡ˆ A éœ€è¦çš„çµæ§‹**ï¼š
```sql
CREATE TABLE document_embeddings (
    id SERIAL PRIMARY KEY,
    source_table VARCHAR(100) NOT NULL,
    source_id INTEGER NOT NULL,
    text_content TEXT,
    content_hash VARCHAR(64),
    
    -- âœ¨ æ–°å¢ï¼šæ¨™é¡Œå‘é‡
    title_embedding vector(1024),
    -- âœ¨ æ–°å¢ï¼šå…§å®¹å‘é‡
    content_embedding vector(1024),
    
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

**å½±éŸ¿**ï¼š
- âœ… **Protocol Assistant**ï¼šéœ€è¦é‡æ–°ç”Ÿæˆæ‰€æœ‰å‘é‡ï¼ˆ5 ç­†ï¼‰
- âœ… **RVT Assistant**ï¼šéœ€è¦é‡æ–°ç”Ÿæˆæ‰€æœ‰å‘é‡ï¼ˆ2 ç­†ï¼‰
- âš ï¸ è¡¨çµæ§‹è®Šæ›´æœƒå½±éŸ¿**æ‰€æœ‰ç¾æœ‰è³‡æ–™**

---

### å±¤é¢ 2ï¼šå‘é‡ç”Ÿæˆé‚è¼¯ âš ï¸ **æœƒå½±éŸ¿å…¨éƒ¨**

**ç•¶å‰å¯¦ç¾**ï¼ˆ`BaseKnowledgeBaseVectorService`ï¼‰ï¼š
```python
def generate_and_store_vector(self, instance, action='create'):
    """ç”Ÿæˆä¸¦å­˜å„²å‘é‡ï¼ˆåªç”Ÿæˆä¸€å€‹å‘é‡ï¼‰"""
    content = self._get_content_for_vectorization(instance)
    # âš ï¸ æ¨™é¡Œå’Œå…§å®¹åˆä½µç‚ºä¸€å€‹å‘é‡
    service.store_document_embedding(
        source_table=self.source_table,
        source_id=instance.id,
        content=content,  # "Title: xxx | Content: xxx"
        use_1024_table=True
    )
```

**æ–¹æ¡ˆ A éœ€è¦çš„å¯¦ç¾**ï¼š
```python
def generate_and_store_vector(self, instance, action='create'):
    """ç”Ÿæˆä¸¦å­˜å„²å‘é‡ï¼ˆç”Ÿæˆå…©å€‹å‘é‡ï¼‰"""
    # âœ¨ åˆ†åˆ¥ç²å–æ¨™é¡Œå’Œå…§å®¹
    title = self._get_title_for_vectorization(instance)
    content = self._get_content_for_vectorization(instance)
    
    # âœ¨ ç”Ÿæˆå…©å€‹å‘é‡
    service.store_document_embeddings_multi(
        source_table=self.source_table,
        source_id=instance.id,
        title=title,
        content=content,
        use_1024_table=True
    )
```

**å½±éŸ¿**ï¼š
- âœ… **Protocol Assistant**ï¼šè‡ªå‹•ç¹¼æ‰¿æ–°çš„å‘é‡ç”Ÿæˆé‚è¼¯
- âœ… **RVT Assistant**ï¼šè‡ªå‹•ç¹¼æ‰¿æ–°çš„å‘é‡ç”Ÿæˆé‚è¼¯
- âš ï¸ éœ€è¦ä¿®æ”¹ `BaseKnowledgeBaseVectorService` åŸºç¤é¡åˆ¥
- âš ï¸ éœ€è¦ç‚ºæ¯å€‹ Assistant æ·»åŠ  `_get_title_for_vectorization()` æ–¹æ³•

---

### å±¤é¢ 3ï¼šå‘é‡æœç´¢é‚è¼¯ âš ï¸ **æœƒå½±éŸ¿å…¨éƒ¨**

**ç•¶å‰å¯¦ç¾**ï¼ˆ`embedding_service.search_similar_documents`ï¼‰ï¼š
```python
def search_similar_documents(self, query, source_table, limit=5):
    """æœç´¢ç›¸ä¼¼æ–‡æª”ï¼ˆåªè¨ˆç®—ä¸€å€‹ç›¸ä¼¼åº¦ï¼‰"""
    query_embedding = self.generate_embedding(query)
    
    sql = """
        SELECT 
            source_id,
            1 - (embedding <=> %s) as similarity_score
        FROM document_embeddings
        WHERE source_table = %s
        ORDER BY embedding <=> %s
        LIMIT %s
    """
```

**æ–¹æ¡ˆ A éœ€è¦çš„å¯¦ç¾**ï¼š
```python
def search_similar_documents_multi(self, query, source_table, limit=5, 
                                   title_weight=0.6, content_weight=0.4):
    """æœç´¢ç›¸ä¼¼æ–‡æª”ï¼ˆè¨ˆç®—å…©å€‹ç›¸ä¼¼åº¦ä¸¦åŠ æ¬Šåˆä½µï¼‰"""
    query_embedding = self.generate_embedding(query)
    
    sql = """
        SELECT 
            source_id,
            -- âœ¨ è¨ˆç®—æ¨™é¡Œç›¸ä¼¼åº¦
            1 - (title_embedding <=> %s) as title_score,
            -- âœ¨ è¨ˆç®—å…§å®¹ç›¸ä¼¼åº¦
            1 - (content_embedding <=> %s) as content_score,
            -- âœ¨ åŠ æ¬Šåˆä½µ
            (%s * (1 - (title_embedding <=> %s))) + 
            (%s * (1 - (content_embedding <=> %s))) as final_score
        FROM document_embeddings
        WHERE source_table = %s
        ORDER BY final_score DESC
        LIMIT %s
    """
```

**å½±éŸ¿**ï¼š
- âœ… **Protocol Assistant**ï¼šæœç´¢çµæœæœƒæ”¹è®Šï¼ˆæ¨™é¡ŒåŒ¹é…æœ‰æ›´é«˜æ¬Šé‡ï¼‰
- âœ… **RVT Assistant**ï¼šæœç´¢çµæœæœƒæ”¹è®Šï¼ˆæ¨™é¡ŒåŒ¹é…æœ‰æ›´é«˜æ¬Šé‡ï¼‰
- âš ï¸ éœ€è¦ä¿®æ”¹ `api/services/embedding_service.py`
- âš ï¸ éœ€è¦ä¿®æ”¹ `vector_search_helper.py`

---

### å±¤é¢ 4ï¼šå‘é‡ç´¢å¼• âš ï¸ **éœ€è¦é‡å»º**

**ç•¶å‰ç´¢å¼•**ï¼š
```sql
CREATE INDEX idx_document_embeddings_vector 
    ON document_embeddings 
    USING ivfflat (embedding vector_cosine_ops) WITH (lists = 100);
```

**æ–¹æ¡ˆ A éœ€è¦çš„ç´¢å¼•**ï¼š
```sql
-- âœ¨ æ¨™é¡Œå‘é‡ç´¢å¼•
CREATE INDEX idx_document_embeddings_title_vector 
    ON document_embeddings 
    USING ivfflat (title_embedding vector_cosine_ops) WITH (lists = 100);

-- âœ¨ å…§å®¹å‘é‡ç´¢å¼•
CREATE INDEX idx_document_embeddings_content_vector 
    ON document_embeddings 
    USING ivfflat (content_embedding vector_cosine_ops) WITH (lists = 100);
```

**å½±éŸ¿**ï¼š
- âš ï¸ ç´¢å¼•é‡å»ºéœ€è¦æ™‚é–“ï¼ˆè³‡æ–™é‡è¶Šå¤§è¶Šæ…¢ï¼‰
- âš ï¸ å…©å€‹ç´¢å¼•æœƒä½”ç”¨æ›´å¤šç£ç¢Ÿç©ºé–“

---

## ğŸ“Š éœ€è¦ä¿®æ”¹çš„æª”æ¡ˆæ¸…å–®

### æ ¸å¿ƒæª”æ¡ˆï¼ˆå¿…é ˆä¿®æ”¹ï¼‰

| æª”æ¡ˆ | å½±éŸ¿ | ä¿®æ”¹å…§å®¹ |
|------|------|---------|
| `scripts/init-pgvector.sql` | Protocol + RVT | ä¿®æ”¹è¡¨çµæ§‹ï¼Œæ·»åŠ å…©å€‹å‘é‡æ¬„ä½ |
| `api/services/embedding_service.py` | Protocol + RVT | æ·»åŠ å¤šå‘é‡ç”Ÿæˆå’Œæœç´¢æ–¹æ³• |
| `library/common/knowledge_base/base_vector_service.py` | Protocol + RVT | ä¿®æ”¹å‘é‡ç”Ÿæˆé‚è¼¯ |
| `library/common/knowledge_base/vector_search_helper.py` | Protocol + RVT | ä¿®æ”¹æœç´¢é‚è¼¯ |
| `library/common/knowledge_base/base_search_service.py` | Protocol + RVT | ä¿®æ”¹æœç´¢èª¿ç”¨æ–¹å¼ |

### Assistant ç‰¹å®šæª”æ¡ˆï¼ˆéœ€è¦èª¿æ•´ï¼‰

| æª”æ¡ˆ | Assistant | ä¿®æ”¹å…§å®¹ |
|------|-----------|---------|
| `library/protocol_guide/vector_service.py` | Protocol | å¯¦ä½œ `_get_title_for_vectorization()` |
| `library/rvt_guide/vector_service.py` | RVT | å¯¦ä½œ `_get_title_for_vectorization()` |

### è³‡æ–™é·ç§»è…³æœ¬ï¼ˆéœ€è¦å‰µå»ºï¼‰

| è…³æœ¬ | ç”¨é€” |
|------|------|
| `scripts/migrate_to_multi_vector.py` | å°‡ç¾æœ‰å–®å‘é‡è³‡æ–™é·ç§»ç‚ºå¤šå‘é‡ |
| `scripts/rebuild_vector_indexes.sql` | é‡å»ºå‘é‡ç´¢å¼• |

---

## âš ï¸ é‡è¦å½±éŸ¿èˆ‡é¢¨éšª

### 1. **è³‡æ–™é·ç§»é¢¨éšª**

- âš ï¸ **Protocol Guide**ï¼š5 ç­†è³‡æ–™éœ€è¦é‡æ–°ç”Ÿæˆå‘é‡
- âš ï¸ **RVT Guide**ï¼š2 ç­†è³‡æ–™éœ€è¦é‡æ–°ç”Ÿæˆå‘é‡
- âš ï¸ é·ç§»æœŸé–“å‘é‡æœç´¢åŠŸèƒ½æœƒ**æš«æ™‚ä¸å¯ç”¨**

### 2. **æ•ˆèƒ½å½±éŸ¿**

**å‘é‡ç”Ÿæˆæ™‚é–“**ï¼š
- å–®å‘é‡ï¼š~0.2 ç§’/ç­†
- å¤šå‘é‡ï¼š~0.4 ç§’/ç­†ï¼ˆå…©å€æ™‚é–“ï¼‰

**å‘é‡æœç´¢æ™‚é–“**ï¼š
- å–®å‘é‡ï¼š~0.05 ç§’/æŸ¥è©¢
- å¤šå‘é‡ï¼š~0.10 ç§’/æŸ¥è©¢ï¼ˆéœ€è¦è¨ˆç®—å…©æ¬¡ç›¸ä¼¼åº¦ï¼‰

**å„²å­˜ç©ºé–“**ï¼š
- å–®å‘é‡ï¼š1024 ç¶­ Ã— 4 bytes = 4KB/ç­†
- å¤šå‘é‡ï¼š1024 ç¶­ Ã— 2 Ã— 4 bytes = 8KB/ç­†ï¼ˆå…©å€ç©ºé–“ï¼‰

### 3. **ç¶­è­·æˆæœ¬**

- âš ï¸ å¢åŠ ç³»çµ±è¤‡é›œåº¦
- âš ï¸ éœ€è¦èª¿æ•´æ¨™é¡Œ/å…§å®¹æ¬Šé‡åƒæ•¸
- âš ï¸ éœ€è¦æ›´å¤šæ¸¬è©¦å’Œé©—è­‰

---

## ğŸ”„ å¯¦æ–½æ­¥é©Ÿï¼ˆå¦‚æœè¦åšï¼‰

### Phase 1ï¼šè³‡æ–™åº«æº–å‚™ï¼ˆåœæ©Ÿæ™‚é–“ ~10 åˆ†é˜ï¼‰

1. **å‚™ä»½ç¾æœ‰è³‡æ–™**
   ```bash
   docker exec postgres_db pg_dump -U postgres ai_platform > backup_before_multi_vector.sql
   ```

2. **ä¿®æ”¹è¡¨çµæ§‹**
   ```sql
   ALTER TABLE document_embeddings 
       ADD COLUMN title_embedding vector(1024),
       ADD COLUMN content_embedding vector(1024);
   ```

3. **å»ºç«‹ç´¢å¼•**
   ```sql
   CREATE INDEX idx_document_embeddings_title_vector ...
   CREATE INDEX idx_document_embeddings_content_vector ...
   ```

### Phase 2ï¼šç¨‹å¼ç¢¼ä¿®æ”¹ï¼ˆé–‹ç™¼æ™‚é–“ ~4 å°æ™‚ï¼‰

1. ä¿®æ”¹ `embedding_service.py`ï¼ˆæ–°å¢å¤šå‘é‡æ–¹æ³•ï¼‰
2. ä¿®æ”¹ `base_vector_service.py`ï¼ˆæ–°å¢åˆ†é›¢é‚è¼¯ï¼‰
3. ä¿®æ”¹ `vector_search_helper.py`ï¼ˆæ–°å¢åŠ æ¬Šæœç´¢ï¼‰
4. ä¿®æ”¹ Protocol å’Œ RVT çš„ `vector_service.py`

### Phase 3ï¼šè³‡æ–™é·ç§»ï¼ˆåŸ·è¡Œæ™‚é–“ ~5 åˆ†é˜ï¼‰

1. ç‚º Protocol Guide é‡æ–°ç”Ÿæˆå‘é‡ï¼ˆ5 ç­†ï¼‰
2. ç‚º RVT Guide é‡æ–°ç”Ÿæˆå‘é‡ï¼ˆ2 ç­†ï¼‰
3. é©—è­‰å‘é‡è³‡æ–™å®Œæ•´æ€§

### Phase 4ï¼šæ¸¬è©¦é©—è­‰ï¼ˆæ¸¬è©¦æ™‚é–“ ~2 å°æ™‚ï¼‰

1. æ¸¬è©¦å‘é‡ç”ŸæˆåŠŸèƒ½
2. æ¸¬è©¦å‘é‡æœç´¢åŠŸèƒ½
3. æ¸¬è©¦åŠ æ¬Šåƒæ•¸èª¿æ•´
4. å°æ¯”æœç´¢çµæœæ”¹å–„

---

## ğŸ’¡ å»ºè­°

### æ–¹æ¡ˆ A çš„å¥½è™•ï¼ˆè©³ç´°åˆ†æï¼‰

#### âœ… **å¥½è™• 1ï¼šæ¨™é¡Œèªç¾©åŒ¹é…æ›´ç²¾æº–**

**å•é¡Œå ´æ™¯**ï¼š
```
æŸ¥è©¢ï¼š"å¦‚ä½•é€£æ¥ ULINK"
æ–‡æª” A æ¨™é¡Œï¼š"ULINK é€£æ¥æ¸¬è©¦æŒ‡å—"ï¼ˆé«˜åº¦ç›¸é—œï¼‰
æ–‡æª” B æ¨™é¡Œï¼š"IOL æ”¾æ¸¬ SOP"ï¼Œå…§å®¹ä¸­æœ‰ï¼š"...ä½¿ç”¨ ULINK é€£æ¥..."ï¼ˆä½åº¦ç›¸é—œï¼‰
```

**ç•¶å‰å–®å‘é‡æ–¹æ³•**ï¼š
- æ¨™é¡Œå’Œå…§å®¹æ··åˆæˆä¸€å€‹å‘é‡
- ç„¡æ³•å€åˆ†ã€Œæ¨™é¡ŒåŒ¹é…ã€vsã€Œå…§å®¹åŒ¹é…ã€
- å¯èƒ½å› ç‚ºæ–‡æª” B å…§å®¹å¾ˆé•·ï¼Œåè€Œæ’åæ›´é«˜

**æ–¹æ¡ˆ A å¤šå‘é‡æ–¹æ³•**ï¼š
```python
# åˆ†åˆ¥è¨ˆç®—
title_score_A = 0.92  # "ULINK é€£æ¥" vs "ULINK é€£æ¥æ¸¬è©¦æŒ‡å—"
content_score_A = 0.65

title_score_B = 0.15  # "ULINK é€£æ¥" vs "IOL æ”¾æ¸¬ SOP"
content_score_B = 0.55

# åŠ æ¬Šåˆä½µï¼ˆæ¨™é¡Œæ¬Šé‡ 60%ï¼‰
final_score_A = 0.6 * 0.92 + 0.4 * 0.65 = 0.81 â­
final_score_B = 0.6 * 0.15 + 0.4 * 0.55 = 0.31
```

**çµæœ**ï¼šâœ… æ–‡æª” A æ­£ç¢ºæ’åœ¨æ–‡æª” B å‰é¢

---

#### âœ… **å¥½è™• 2ï¼šå¯èª¿æ•´æ¬Šé‡åƒæ•¸**

**éˆæ´»æ€§**ï¼š
```python
# ä¸åŒæƒ…å¢ƒä½¿ç”¨ä¸åŒæ¬Šé‡
def search_with_custom_weights(query, title_weight=0.6, content_weight=0.4):
    """
    å¯æ ¹æ“šæŸ¥è©¢é¡å‹èª¿æ•´æ¬Šé‡ï¼š
    - æŸ¥è©¢æ–‡æª”åç¨±ï¼štitle_weight = 0.8
    - æŸ¥è©¢å…·é«”æ­¥é©Ÿï¼štitle_weight = 0.4
    - å¹³è¡¡æŸ¥è©¢ï¼štitle_weight = 0.6
    """
```

**å¯¦éš›æ‡‰ç”¨**ï¼š
```python
# æ¡ˆä¾‹ 1ï¼šç”¨æˆ¶æ˜ç¢ºæ‰¾æ–‡æª”
search("ULINK æ¸¬è©¦æŒ‡å—", title_weight=0.8)  # å¼·èª¿æ¨™é¡Œ

# æ¡ˆä¾‹ 2ï¼šç”¨æˆ¶æ‰¾å…·é«”æ“ä½œ
search("å¦‚ä½•è¨­å®šåƒæ•¸", title_weight=0.4)  # å¼·èª¿å…§å®¹

# æ¡ˆä¾‹ 3ï¼šä¸€èˆ¬æŸ¥è©¢
search("Protocol æ¸¬è©¦", title_weight=0.6)  # å¹³è¡¡
```

---

#### âœ… **å¥½è™• 3ï¼šæä¾›æ›´å¤šèª¿è©¦è³‡è¨Š**

**ç•¶å‰å–®å‘é‡**ï¼š
```json
{
  "title": "ULINK é€£æ¥æ¸¬è©¦",
  "score": 0.75  // ç„¡æ³•çŸ¥é“æ˜¯æ¨™é¡Œé‚„æ˜¯å…§å®¹åŒ¹é…
}
```

**æ–¹æ¡ˆ A å¤šå‘é‡**ï¼š
```json
{
  "title": "ULINK é€£æ¥æ¸¬è©¦",
  "title_score": 0.92,      // âœ¨ æ¨™é¡Œèªç¾©ç›¸ä¼¼åº¦
  "content_score": 0.65,    // âœ¨ å…§å®¹èªç¾©ç›¸ä¼¼åº¦
  "final_score": 0.81,      // âœ¨ åŠ æ¬Šçµæœ
  "match_type": "title_primary"  // âœ¨ åŒ¹é…é¡å‹
}
```

**å¥½è™•**ï¼š
- å¯ä»¥äº†è§£ç‚ºä»€éº¼æŸå€‹çµæœæ’åé«˜
- å¯ä»¥é‡å°æ€§èª¿æ•´æ¬Šé‡åƒæ•¸
- å¯ä»¥åˆ†æç”¨æˆ¶æŸ¥è©¢æ¨¡å¼

---

#### âœ… **å¥½è™• 4ï¼šæ¸›å°‘ã€Œé•·æ–‡æª”åå¥½ã€å•é¡Œ**

**å•é¡Œ**ï¼šç•¶å‰å–®å‘é‡æ–¹æ³•ä¸­ï¼Œå…§å®¹å¾ˆé•·çš„æ–‡æª”å¯èƒ½ç²å¾—æ›´é«˜åˆ†æ•¸ï¼Œå³ä½¿æ¨™é¡Œä¸ç›¸é—œã€‚

**åŸå› **ï¼š
```python
# å–®å‘é‡å…§å®¹æ ¼å¼
content = f"Title: {title} | Content: {long_content}"
# å¦‚æœ long_content æœ‰ 5000 å­—ï¼Œtitle åªæœ‰ 10 å­—
# å‘é‡æœƒè¢«å…§å®¹ä¸»å°ï¼Œæ¨™é¡Œå½±éŸ¿åŠ›è¢«ç¨€é‡‹
```

**æ–¹æ¡ˆ A è§£æ±º**ï¼š
```python
# æ¨™é¡Œå’Œå…§å®¹åˆ†åˆ¥å‘é‡åŒ–
title_embedding = generate_embedding(title)      # ç´”æ¨™é¡Œå‘é‡
content_embedding = generate_embedding(content)  # ç´”å…§å®¹å‘é‡

# æ¨™é¡Œçš„å½±éŸ¿åŠ›ä¸æœƒè¢«å…§å®¹é•·åº¦ç¨€é‡‹
final_score = 0.6 * title_score + 0.4 * content_score
```

---

#### âœ… **å¥½è™• 5ï¼šæ”¯æ´æ›´è¤‡é›œçš„æœç´¢ç­–ç•¥**

**é€²éšæ‡‰ç”¨ 1ï¼šæ··åˆæœç´¢**
```python
def hybrid_search(query):
    # å…ˆç”¨æ¨™é¡Œå¿«é€Ÿç¯©é¸
    candidates = search_by_title(query, threshold=0.7, limit=20)
    
    # å†ç”¨å…§å®¹ç²¾ç¢ºæ’åº
    results = rank_by_content(candidates, query)
    
    return results[:5]
```

**é€²éšæ‡‰ç”¨ 2ï¼šåˆ†éšæ®µæœç´¢**
```python
def staged_search(query):
    # éšæ®µ 1ï¼šæ¨™é¡Œç²¾ç¢ºåŒ¹é…ï¼ˆé«˜æ¬Šé‡ï¼‰
    exact_matches = search(query, title_weight=0.9, threshold=0.8)
    
    # éšæ®µ 2ï¼šå…§å®¹èªç¾©åŒ¹é…ï¼ˆå¦‚æœçµæœä¸è¶³ï¼‰
    if len(exact_matches) < 3:
        semantic_matches = search(query, title_weight=0.3, threshold=0.6)
        exact_matches.extend(semantic_matches)
    
    return exact_matches[:5]
```

**é€²éšæ‡‰ç”¨ 3ï¼šç”¨æˆ¶åå¥½å­¸ç¿’**
```python
# æ ¹æ“šç”¨æˆ¶é»æ“Šè¡Œç‚ºå‹•æ…‹èª¿æ•´æ¬Šé‡
user_preference = analyze_click_history(user_id)

if user_preference == 'title_focused':
    title_weight = 0.8  # ç”¨æˆ¶å‚¾å‘é»æ“Šæ¨™é¡ŒåŒ¹é…çš„çµæœ
else:
    title_weight = 0.5  # ç”¨æˆ¶å‚¾å‘æ·±åº¦å…§å®¹
```

---

#### âœ… **å¥½è™• 6ï¼šæ›´å¥½çš„æ–‡æª”çµ„ç¹”æç¤º**

**åˆ†æåŠŸèƒ½**ï¼š
```python
def analyze_document_quality(doc_id):
    """åˆ†ææ–‡æª”æ¨™é¡Œèˆ‡å…§å®¹çš„ä¸€è‡´æ€§"""
    results = []
    
    for query in common_queries:
        title_score = search_by_title(query, doc_id)
        content_score = search_by_content(query, doc_id)
        
        # å¦‚æœæ¨™é¡Œåˆ†æ•¸ä½ä½†å…§å®¹åˆ†æ•¸é«˜ â†’ æ¨™é¡Œä¸å¤ æè¿°æ€§
        if title_score < 0.5 and content_score > 0.8:
            results.append({
                'query': query,
                'issue': 'title_not_descriptive',
                'suggestion': f'æ¨™é¡Œæ‡‰è©²åŒ…å« "{query}"'
            })
    
    return results
```

**å¯¦éš›åƒ¹å€¼**ï¼š
- å¹«åŠ©å…§å®¹ä½œè€…æ”¹å–„æ–‡æª”æ¨™é¡Œ
- æé«˜çŸ¥è­˜åº«æ•´é«”å“è³ª
- æ¸›å°‘ç”¨æˆ¶æœç´¢å›°é›£

---

### æ–¹æ¡ˆæ¯”è¼ƒï¼ˆå®Œæ•´ç‰ˆï¼‰

| æ–¹æ¡ˆ | å„ªé» | ç¼ºé» | å½±éŸ¿ç¯„åœ | é©ç”¨å ´æ™¯ |
|------|------|------|---------|---------|
| **æ–¹æ¡ˆ Aï¼šå¤šå‘é‡** | â€¢ æ¨™é¡ŒåŒ¹é…ç²¾æº–<br>â€¢ æ¬Šé‡å¯èª¿æ•´<br>â€¢ è±å¯Œèª¿è©¦è³‡è¨Š<br>â€¢ é¿å…é•·æ–‡æª”åå¥½<br>â€¢ æ”¯æ´é€²éšæœç´¢ | â€¢ è¤‡é›œåº¦é«˜<br>â€¢ éœ€è¦é·ç§»<br>â€¢ æ•ˆèƒ½é–‹éŠ· 2x<br>â€¢ å„²å­˜ç©ºé–“ 2x | Protocol + RVT å…¨éƒ¨å—å½±éŸ¿ | è³‡æ–™é‡å¤§ã€æŸ¥è©¢å¤šæ¨£ã€éœ€è¦ç²¾æº–æ¨™é¡ŒåŒ¹é… |
| **æ–¹æ¡ˆ Bï¼šä¿æŒç¾ç‹€** | â€¢ ç°¡å–®ç©©å®š<br>â€¢ ç„¡éœ€é·ç§»<br>â€¢ æ•ˆèƒ½å¥½ | â€¢ æ¨™é¡Œæ¬Šé‡å›ºå®š<br>â€¢ é•·æ–‡æª”åå¥½<br>â€¢ èª¿è©¦è³‡è¨Šå°‘ | ç„¡å½±éŸ¿ | è³‡æ–™é‡å°ã€æŸ¥è©¢ç°¡å–®ã€ç¾æ³æ»¿æ„ |
| **æ–¹æ¡ˆ Cï¼šåªæ”¹é—œéµå­—** | â€¢ ç°¡å–®å¿«é€Ÿ<br>â€¢ ç„¡éœ€é·ç§»<br>â€¢ ç«‹å³è¦‹æ•ˆ | â€¢ åªå½±éŸ¿é—œéµå­—æœç´¢<br>â€¢ å‘é‡æœç´¢ç„¡æ”¹å–„ | ç„¡éœ€é·ç§» | å¿«é€Ÿæ”¹å–„ã€éæ¸¡æ–¹æ¡ˆ |

---

### æ–¹æ¡ˆ A ä»€éº¼æ™‚å€™å€¼å¾—å¯¦æ–½ï¼Ÿ

#### âœ… **å»ºè­°å¯¦æ–½çš„æƒ…æ³**

1. **è³‡æ–™é‡é”åˆ°é–€æª»**ï¼ˆ> 500 ç­†ï¼‰
   - ç•¶å‰ï¼šProtocol Guide (5 ç­†) + RVT Guide (2 ç­†) = **7 ç­†**
   - é·ç§»æˆæœ¬ï¼š~5 åˆ†é˜
   - æœªä¾† 500 ç­†ï¼šé·ç§»æˆæœ¬ ~2 å°æ™‚

2. **æœ‰æ˜ç¢ºçš„ç²¾æº–åº¦å•é¡Œ**
   - ç”¨æˆ¶åé¥‹ï¼šã€Œæœç´¢çµæœä¸æº–ç¢ºã€
   - è³‡æ–™é¡¯ç¤ºï¼šæ¨™é¡Œç›¸é—œçš„æ–‡æª”æ’åä¸å¤ é«˜
   - A/B æ¸¬è©¦ï¼šå¤šå‘é‡æ–¹æ³•æ˜é¡¯å„ªæ–¼å–®å‘é‡

3. **éœ€è¦æ”¯æ´å¤šç¨®æŸ¥è©¢æ¨¡å¼**
   - ç²¾ç¢ºæ–‡æª”æŸ¥æ‰¾ï¼ˆå¼·èª¿æ¨™é¡Œï¼‰
   - æ·±åº¦å…§å®¹æœç´¢ï¼ˆå¼·èª¿å…§å®¹ï¼‰
   - æ··åˆèªç¾©æŸ¥è©¢ï¼ˆå¹³è¡¡æ¬Šé‡ï¼‰

4. **æœ‰å°ˆé–€çš„é–‹ç™¼æ™‚é–“**
   - è¨ˆåŠƒæ€§çš„ç³»çµ±å‡ç´š
   - æœ‰å……è¶³çš„æ¸¬è©¦æ™‚é–“
   - å¯ä»¥æ‰¿å—çŸ­æœŸåœæ©Ÿ

#### âš ï¸ **ç•¶å‰ä¸å»ºè­°å¯¦æ–½çš„åŸå› **

**åŸºæ–¼æ•¸æ“šçš„æ±ºç­–**ï¼š

| è©•ä¼°é …ç›® | ç•¶å‰ç‹€æ³ | æ–¹æ¡ˆ A è¦æ±‚ | çµè«– |
|---------|---------|------------|-----|
| **è³‡æ–™é‡** | 7 ç­† | > 500 ç­† | âŒ ä¸ç¬¦åˆ |
| **ç²¾æº–åº¦å•é¡Œ** | æœªç¢ºèª | æœ‰æ˜ç¢ºè­‰æ“š | âŒ ä¸ç¬¦åˆ |
| **é–‹ç™¼æ™‚é–“** | ç·Šæ€¥éœ€æ±‚ | 8 å°æ™‚ + æ¸¬è©¦ | âŒ ä¸ç¬¦åˆ |
| **ROI** | ä½ï¼ˆ7 ç­†è³‡æ–™ï¼‰ | é«˜ï¼ˆå¤§é‡è³‡æ–™ï¼‰ | âŒ ä¸ç¬¦åˆ |

**æˆæœ¬æ”¶ç›Šåˆ†æ**ï¼š

```
æŠ•å…¥æˆæœ¬ï¼š
- é–‹ç™¼æ™‚é–“ï¼š~8 å°æ™‚
- æ¸¬è©¦æ™‚é–“ï¼š~4 å°æ™‚
- é·ç§»æ™‚é–“ï¼š~0.5 å°æ™‚
- ç¸½è¨ˆï¼š~12.5 å°æ™‚

é æœŸæ”¶ç›Šï¼š
- 7 ç­†è³‡æ–™çš„ç²¾æº–åº¦æå‡ï¼šæœ‰é™
- æ¬Šé‡èª¿æ•´éˆæ´»æ€§ï¼šæœ‰åƒ¹å€¼ï¼Œä½†ç•¶å‰éœ€æ±‚ä¸æ˜ç¢º
- èª¿è©¦è³‡è¨Šï¼šæœ‰åƒ¹å€¼ï¼Œä½†ç•¶å‰æ²’æœ‰èª¿è©¦éœ€æ±‚

çµè«–ï¼šç•¶å‰ ROI ä¸é«˜
```

---

### å€‹äººå»ºè­°ï¼ˆåŸºæ–¼æ•¸æ“šï¼‰

**éšæ®µæ€§å¯¦æ–½ç­–ç•¥**ï¼š

#### **ç•¶å‰éšæ®µï¼ˆè³‡æ–™é‡ < 100 ç­†ï¼‰**
âŒ **ä¸å»ºè­°ç«‹å³å¯¦æ–½æ–¹æ¡ˆ A**

**åŸå› **ï¼š
1. **å½±éŸ¿ç¯„åœéå¤§**ï¼šProtocol + RVT å…©å€‹ Assistant å…¨éƒ¨å—å½±éŸ¿
2. **è¤‡é›œåº¦é«˜**ï¼šéœ€è¦ä¿®æ”¹ 5 å€‹æ ¸å¿ƒæª”æ¡ˆ
3. **è³‡æ–™é·ç§»é¢¨éšª**ï¼šéœ€è¦åœæ©Ÿé‡æ–°ç”Ÿæˆå‘é‡
4. **æ•ˆèƒ½é–‹éŠ·**ï¼šç”Ÿæˆå’Œæœç´¢æ™‚é–“å¢åŠ  2 å€
5. **ROI ä¸é«˜**ï¼š7 ç­†è³‡æ–™çš„æ”¹å–„æœ‰é™

#### **æœªä¾†éšæ®µï¼ˆè³‡æ–™é‡ > 500 ç­†ï¼‰**
âœ… **å¯ä»¥è€ƒæ…®å¯¦æ–½æ–¹æ¡ˆ A**

**è§¸ç™¼æ¢ä»¶**ï¼ˆæ»¿è¶³ä»»ä¸€å³å¯è€ƒæ…®ï¼‰ï¼š
1. ğŸ“Š **è³‡æ–™é‡é”æ¨™**ï¼šå–®ä¸€ Assistant è³‡æ–™ > 500 ç­†
2. ğŸ› **æœ‰ç²¾æº–åº¦å•é¡Œ**ï¼šç”¨æˆ¶åé¥‹æˆ–æ•¸æ“šé¡¯ç¤ºæœç´¢çµæœä¸ä½³
3. ğŸ¯ **æœ‰æ˜ç¢ºéœ€æ±‚**ï¼šéœ€è¦æ”¯æ´å¤šç¨®æŸ¥è©¢æ¨¡å¼æˆ–æ¬Šé‡èª¿æ•´
4. ğŸ”¬ **æœ‰æ¸¬è©¦è­‰æ“š**ï¼šA/B æ¸¬è©¦è­‰æ˜å¤šå‘é‡æ–¹æ³•æ˜é¡¯æ›´å¥½

**å»ºè­°æ¡ç”¨æ¼¸é€²å¼æ–¹æ¡ˆ**ï¼š

### æ¼¸é€²å¼æ–¹æ¡ˆï¼ˆæ¨è–¦ï¼‰

#### **éšæ®µ 1ï¼šå…ˆæ”¹å–„é—œéµå­—æœç´¢**ï¼ˆå·²å®Œæˆï¼‰
- âœ… æ¨™é¡ŒåŒ¹é…ï¼š0.7 ~ 1.0 åˆ†æ•¸
- âœ… å…§å®¹åŒ¹é…ï¼š0.3 ~ 0.6 åˆ†æ•¸
- âœ… ç„¡éœ€ä¿®æ”¹å‘é‡é‚è¼¯

#### **éšæ®µ 2ï¼šèª¿æ•´æœç´¢ç­–ç•¥**ï¼ˆå¯ç«‹å³å¯¦æ–½ï¼‰
```python
# åœ¨ base_search_service.py ä¸­èª¿æ•´
def search_knowledge(self, query, limit=5, use_vector=True, threshold=0.7):
    # å„ªå…ˆä½¿ç”¨å‘é‡æœç´¢ï¼Œä½†é™ä½ threshold
    vector_results = self.search_with_vectors(query, limit, threshold * 0.85)
    
    # è£œå……é«˜æ¬Šé‡çš„é—œéµå­—æ¨™é¡ŒåŒ¹é…
    if len(vector_results) < limit:
        keyword_results = self.search_with_keywords(query, limit, threshold * 0.5)
        # éæ¿¾å‡ºæ¨™é¡ŒåŒ¹é…çš„çµæœï¼ˆåˆ†æ•¸ >= 0.7ï¼‰
        title_matches = [r for r in keyword_results if r['score'] >= 0.7]
        vector_results.extend(title_matches)
```

#### **éšæ®µ 3ï¼šå¦‚æœçœŸçš„éœ€è¦ï¼Œå†è€ƒæ…®å¤šå‘é‡**ï¼ˆæœªä¾†è¦åŠƒï¼‰
- ç­‰åˆ°è³‡æ–™é‡è®Šå¤§ï¼ˆ> 1000 ç­†ï¼‰
- ç­‰åˆ°æœ‰æ˜ç¢ºçš„ç²¾æº–åº¦å•é¡Œ
- è¨ˆåŠƒæ€§åœ°é€²è¡Œç³»çµ±å‡ç´š

---

## ï¿½ å¯¦éš›æ¡ˆä¾‹å°æ¯”

### æ¡ˆä¾‹ 1ï¼šæ¨™é¡Œç²¾ç¢ºåŒ¹é… vs å…§å®¹æ¨¡ç³ŠåŒ¹é…

**æŸ¥è©¢**ï¼šã€ŒULINK é€£æ¥æ¸¬è©¦ã€

**æ–‡æª” A**ï¼š
- æ¨™é¡Œï¼šã€ŒULINK Protocol é€£æ¥æ¸¬è©¦æŒ‡å—ã€ï¼ˆ10 å­—ï¼‰
- å…§å®¹ï¼šã€Œæœ¬æ–‡æª”ä»‹ç´¹å¦‚ä½•é€²è¡Œ ULINK æ¸¬è©¦...ã€ï¼ˆ300 å­—ï¼‰

**æ–‡æª” B**ï¼š
- æ¨™é¡Œï¼šã€ŒIOL æ”¾æ¸¬ SOPã€ï¼ˆ7 å­—ï¼‰
- å…§å®¹ï¼šã€Œ...æ­¥é©Ÿ 5ï¼šä½¿ç”¨ ULINK é€²è¡Œé€£æ¥æ¸¬è©¦...ã€ï¼ˆ2000 å­—ï¼ŒåŒ…å«å¤§é‡å…¶ä»–å…§å®¹ï¼‰

#### **å–®å‘é‡æ–¹æ³•ï¼ˆç•¶å‰ï¼‰**

```python
# æ–‡æª” A çš„å‘é‡å…§å®¹
"Title: ULINK Protocol é€£æ¥æ¸¬è©¦æŒ‡å— | Content: æœ¬æ–‡æª”ä»‹ç´¹å¦‚ä½•é€²è¡Œ ULINK æ¸¬è©¦..."
# å‘é‡åŒ–å¾Œï¼Œæ¨™é¡Œä½”æ¯”ï¼š10 / 310 = 3.2%

# æ–‡æª” B çš„å‘é‡å…§å®¹
"Title: IOL æ”¾æ¸¬ SOP | Content: ...æ­¥é©Ÿ 5ï¼šä½¿ç”¨ ULINK é€²è¡Œé€£æ¥æ¸¬è©¦..."
# å‘é‡åŒ–å¾Œï¼Œæ¨™é¡Œä½”æ¯”ï¼š7 / 2007 = 0.3%
```

**æœç´¢çµæœ**ï¼š
```
1. æ–‡æª” B (score: 0.72) âš ï¸ å› ç‚ºå…§å®¹é•·ï¼ŒåŒ…å«æ›´å¤šç›¸é—œè©å½™
2. æ–‡æª” A (score: 0.68) âŒ é›–ç„¶æ¨™é¡Œå®Œå…¨åŒ¹é…ï¼Œä½†è¢«å…§å®¹çŸ­åº¦å½±éŸ¿
```

#### **å¤šå‘é‡æ–¹æ³•ï¼ˆæ–¹æ¡ˆ Aï¼‰**

```python
# æ–‡æª” A
title_score = 0.95    # "ULINK é€£æ¥æ¸¬è©¦" vs "ULINK Protocol é€£æ¥æ¸¬è©¦æŒ‡å—"
content_score = 0.68  # å…§å®¹ç›¸é—œåº¦
final_score = 0.6 * 0.95 + 0.4 * 0.68 = 0.84 âœ…

# æ–‡æª” B
title_score = 0.12    # "ULINK é€£æ¥æ¸¬è©¦" vs "IOL æ”¾æ¸¬ SOP"
content_score = 0.70  # å…§å®¹ä¸­æœ‰æåˆ°ï¼Œä½†ä¸æ˜¯ä¸»é¡Œ
final_score = 0.6 * 0.12 + 0.4 * 0.70 = 0.35 âœ…
```

**æœç´¢çµæœ**ï¼š
```
1. æ–‡æª” A (score: 0.84) âœ… æ¨™é¡Œå®Œå…¨åŒ¹é…ï¼Œæ­£ç¢ºæ’åç¬¬ä¸€
2. æ–‡æª” B (score: 0.35) âœ… é›–ç„¶å…§å®¹æœ‰æåˆ°ï¼Œä½†æ¨™é¡Œä¸ç›¸é—œ
```

**æ”¹å–„æ•ˆæœ**ï¼š
- âœ… æ¨™é¡Œç›¸é—œçš„æ–‡æª”æ­£ç¢ºæ’åœ¨å‰é¢
- âœ… é¿å…äº†ã€Œé•·æ–‡æª”åå¥½ã€å•é¡Œ
- âœ… ç”¨æˆ¶é«”é©—æ˜é¡¯æ”¹å–„

---

### æ¡ˆä¾‹ 2ï¼šæ¬Šé‡èª¿æ•´çš„å¨åŠ›

**å ´æ™¯**ï¼šç”¨æˆ¶æƒ³æ‰¾ã€ŒProtocol æ¸¬è©¦æ­¥é©Ÿã€

**å€™é¸æ–‡æª”**ï¼š
- æ–‡æª” Xï¼šæ¨™é¡Œã€ŒProtocol æ¸¬è©¦æŒ‡å—ã€ï¼Œå…§å®¹ç°¡çŸ­
- æ–‡æª” Yï¼šæ¨™é¡Œã€Œè¨­å‚™é…ç½®èªªæ˜ã€ï¼Œå…§å®¹åŒ…å«è©³ç´°çš„ Protocol æ¸¬è©¦æ­¥é©Ÿ

#### **ä¸åŒæ¬Šé‡é…ç½®çš„çµæœ**

| æ¬Šé‡é…ç½® | æ–‡æª” X åˆ†æ•¸ | æ–‡æª” Y åˆ†æ•¸ | ç¬¬ä¸€å | é©ç”¨å ´æ™¯ |
|---------|------------|------------|--------|---------|
| title=0.8, content=0.2 | **0.82** | 0.45 | æ–‡æª” X | æ‰¾æ–‡æª”åç¨± |
| title=0.6, content=0.4 | **0.74** | 0.58 | æ–‡æª” X | å¹³è¡¡æŸ¥è©¢ |
| title=0.4, content=0.6 | 0.66 | **0.71** | æ–‡æª” Y | æ‰¾å…·é«”æ­¥é©Ÿ |
| title=0.2, content=0.8 | 0.58 | **0.84** | æ–‡æª” Y | æ·±åº¦å…§å®¹æœç´¢ |

**çµè«–**ï¼š
- âœ… å¯ä»¥æ ¹æ“šæŸ¥è©¢é¡å‹å‹•æ…‹èª¿æ•´æ¬Šé‡
- âœ… åŒæ¨£çš„æ–‡æª”ï¼Œä¸åŒå ´æ™¯æœ‰ä¸åŒæ’åº
- âœ… æä¾›æ›´ç²¾æº–çš„æœç´¢çµæœ

---

### æ¡ˆä¾‹ 3ï¼šèª¿è©¦è³‡è¨Šçš„åƒ¹å€¼

**å•é¡Œå ´æ™¯**ï¼šç”¨æˆ¶æŠ±æ€¨æœç´¢ã€ŒSOPã€æ™‚æ‰¾ä¸åˆ°ç›¸é—œæ–‡æª”

#### **å–®å‘é‡æ–¹æ³•ï¼ˆç•¶å‰ï¼‰**

```json
{
  "query": "SOP",
  "results": [
    {"title": "IOL æ”¾æ¸¬ SOP", "score": 0.68},
    {"title": "æ¸¬è©¦æµç¨‹èªªæ˜", "score": 0.45}
  ]
}
```

**ç„¡æ³•å¾—çŸ¥**ï¼š
- â“ 0.68 åˆ†æ•¸æ˜¯å› ç‚ºæ¨™é¡ŒåŒ¹é…é‚„æ˜¯å…§å®¹åŒ¹é…ï¼Ÿ
- â“ ç‚ºä»€éº¼ã€Œæ¸¬è©¦æµç¨‹èªªæ˜ã€ä¹Ÿæœ‰åˆ†æ•¸ï¼Ÿ
- â“ å¦‚ä½•æ”¹å–„æœç´¢çµæœï¼Ÿ

#### **å¤šå‘é‡æ–¹æ³•ï¼ˆæ–¹æ¡ˆ Aï¼‰**

```json
{
  "query": "SOP",
  "results": [
    {
      "title": "IOL æ”¾æ¸¬ SOP",
      "title_score": 0.95,      // âœ… æ¨™é¡Œé«˜åº¦åŒ¹é…
      "content_score": 0.35,    // âš ï¸ å…§å®¹ç›¸é—œåº¦ä½
      "final_score": 0.71,
      "match_type": "title_primary",
      "recommendation": "æ¨™é¡ŒåŒ¹é…è‰¯å¥½ï¼Œè€ƒæ…®è±å¯Œå…§å®¹"
    },
    {
      "title": "æ¸¬è©¦æµç¨‹èªªæ˜",
      "title_score": 0.15,      // âš ï¸ æ¨™é¡Œä¸ç›¸é—œ
      "content_score": 0.82,    // âœ… å…§å®¹é«˜åº¦ç›¸é—œ
      "final_score": 0.42,
      "match_type": "content_primary",
      "recommendation": "è€ƒæ…®åœ¨æ¨™é¡Œä¸­åŠ å…¥ 'SOP' é—œéµå­—"
    }
  ]
}
```

**å¯ä»¥å¾—çŸ¥**ï¼š
- âœ… ã€ŒIOL æ”¾æ¸¬ SOPã€ä¸»è¦æ˜¯æ¨™é¡ŒåŒ¹é…ï¼ˆ0.95ï¼‰
- âœ… ã€Œæ¸¬è©¦æµç¨‹èªªæ˜ã€ä¸»è¦æ˜¯å…§å®¹åŒ¹é…ï¼ˆ0.82ï¼‰
- âœ… å¯ä»¥çµ¦å…§å®¹ä½œè€…æ”¹å–„å»ºè­°
- âœ… å¯ä»¥é‡å°æ€§èª¿æ•´æ¬Šé‡åƒæ•¸

---

## ï¿½ğŸ“ çµè«–

### å•é¡Œç­”æ¡ˆ

> **ä½¿ç”¨æ–¹æ¡ˆ A ä¿®æ”¹æœƒä¸€ä½µä¹Ÿæœƒé€£åŒ RVT Assistant ä¹Ÿä¿®æ”¹å—ï¼Ÿ**

**ç­”ï¼šæ˜¯çš„ï¼Œ100% æœƒå½±éŸ¿ RVT Assistantã€‚**

**åŸå› **ï¼š
1. âœ… å…©å€‹ Assistant ä½¿ç”¨ç›¸åŒçš„åŸºç¤é¡åˆ¥ï¼ˆ`BaseKnowledgeBaseVectorService`ï¼‰
2. âœ… å…±ç”¨åŒä¸€å€‹å‘é‡è¡¨ï¼ˆ`document_embeddings`ï¼‰
3. âœ… å…±ç”¨åŒä¸€å€‹å‘é‡æœå‹™ï¼ˆ`embedding_service`ï¼‰
4. âœ… å…±ç”¨åŒä¸€å€‹æœç´¢é‚è¼¯ï¼ˆ`vector_search_helper`ï¼‰

**å½±éŸ¿ç¯„åœ**ï¼š
- ğŸ“¦ **æ ¸å¿ƒæª”æ¡ˆ**ï¼š5 å€‹ï¼ˆè³‡æ–™åº«ã€æœå‹™ã€åŸºç¤é¡åˆ¥ï¼‰
- ğŸ“¦ **Assistant æª”æ¡ˆ**ï¼š2 å€‹ï¼ˆProtocol + RVTï¼‰
- ğŸ“¦ **å‘é‡è³‡æ–™**ï¼š7 ç­†ï¼ˆéœ€è¦é‡æ–°ç”Ÿæˆï¼‰
- â° **é ä¼°å·¥ä½œé‡**ï¼š~8 å°æ™‚ï¼ˆé–‹ç™¼ + æ¸¬è©¦ + é·ç§»ï¼‰

**å»ºè­°**ï¼š
- âŒ **ä¸å»ºè­°**ç¾åœ¨å¯¦æ–½æ–¹æ¡ˆ Aï¼ˆè³‡æ–™é‡å¤ªå°ï¼ŒROI ä¸é«˜ï¼‰
- âœ… **å»ºè­°**æ¡ç”¨æ¼¸é€²å¼æ”¹å–„æ–¹æ¡ˆï¼ˆå…ˆæ”¹é—œéµå­—æœç´¢ï¼‰
- âœ… **å»ºè­°**å…ˆè©•ä¼°ç¾æœ‰é—œéµå­—æœç´¢æ”¹å–„æ•ˆæœï¼ˆå·²å®Œæˆçš„æ–¹æ¡ˆ 1ï¼‰
- âœ… **å»ºè­°**ç­‰è³‡æ–™é‡è®Šå¤§ï¼ˆ> 500 ç­†ï¼‰å¾Œå†è€ƒæ…®å¤šå‘é‡æ–¹æ¡ˆ

---

## ğŸ¯ ç¸½çµï¼šæ–¹æ¡ˆ A æœ‰å¥½è™•å—ï¼Ÿ

### âœ… **å¥½è™•ç¸½çµï¼ˆ6 å¤§å„ªå‹¢ï¼‰**

| å¥½è™• | å½±éŸ¿ç¨‹åº¦ | ç•¶å‰åƒ¹å€¼ | æœªä¾†åƒ¹å€¼ |
|------|---------|---------|---------|
| 1ï¸âƒ£ **æ¨™é¡ŒåŒ¹é…ç²¾æº–** | é«˜ | ä¸­ï¼ˆ7 ç­†è³‡æ–™ï¼‰ | é«˜ï¼ˆ> 500 ç­†ï¼‰ |
| 2ï¸âƒ£ **æ¬Šé‡å¯èª¿æ•´** | ä¸­ | ä½ï¼ˆéœ€æ±‚ä¸æ˜ç¢ºï¼‰ | é«˜ï¼ˆå¤šæ¨£æŸ¥è©¢ï¼‰ |
| 3ï¸âƒ£ **èª¿è©¦è³‡è¨Šè±å¯Œ** | ä¸­ | ä½ï¼ˆç„¡èª¿è©¦éœ€æ±‚ï¼‰ | ä¸­ï¼ˆå„ªåŒ–éœ€æ±‚ï¼‰ |
| 4ï¸âƒ£ **é¿å…é•·æ–‡æª”åå¥½** | é«˜ | ä¸­ï¼ˆæœ‰æ­¤å•é¡Œï¼‰ | é«˜ï¼ˆå•é¡Œæ›´æ˜é¡¯ï¼‰ |
| 5ï¸âƒ£ **æ”¯æ´é€²éšæœç´¢** | ä½ | ä½ï¼ˆç„¡æ­¤éœ€æ±‚ï¼‰ | é«˜ï¼ˆæœªä¾†éœ€æ±‚ï¼‰ |
| 6ï¸âƒ£ **æ–‡æª”å“è³ªåˆ†æ** | ä½ | ä½ï¼ˆè³‡æ–™å°‘ï¼‰ | ä¸­ï¼ˆå“è³ªç®¡ç†ï¼‰ |

### âš–ï¸ **æˆæœ¬æ”¶ç›Šè©•ä¼°**

**ç•¶å‰ç‹€æ³ï¼ˆ7 ç­†è³‡æ–™ï¼‰**ï¼š
```
æˆæœ¬ï¼š
- é–‹ç™¼æ™‚é–“ï¼š12.5 å°æ™‚
- æ•ˆèƒ½é–‹éŠ·ï¼š2 å€ï¼ˆç”Ÿæˆ + æœç´¢ï¼‰
- å„²å­˜ç©ºé–“ï¼š2 å€
- ç¶­è­·è¤‡é›œåº¦ï¼šæé«˜

æ”¶ç›Šï¼š
- æœç´¢ç²¾æº–åº¦æå‡ï¼šæœ‰é™ï¼ˆè³‡æ–™é‡å°ï¼‰
- éˆæ´»æ€§æå‡ï¼šæœ‰åƒ¹å€¼ï¼Œä½†éœ€æ±‚ä¸æ˜ç¢º
- èª¿è©¦èƒ½åŠ›ï¼šæœ‰åƒ¹å€¼ï¼Œä½†ç•¶å‰ç„¡éœ€æ±‚

ROIï¼šç´„ 20%ï¼ˆä½ï¼‰ âŒ
```

**æœªä¾†ç‹€æ³ï¼ˆ> 500 ç­†è³‡æ–™ï¼‰**ï¼š
```
æˆæœ¬ï¼š
- é–‹ç™¼æ™‚é–“ï¼š12.5 å°æ™‚ï¼ˆä¸€æ¬¡æ€§ï¼‰
- æ•ˆèƒ½é–‹éŠ·ï¼šå¯æ¥å—ï¼ˆ0.4 ç§’ vs 0.2 ç§’ï¼‰
- å„²å­˜ç©ºé–“ï¼šå¯æ¥å—ï¼ˆ4MB vs 2MBï¼‰
- ç¶­è­·è¤‡é›œåº¦ï¼šå¯æ¥å—

æ”¶ç›Šï¼š
- æœç´¢ç²¾æº–åº¦æå‡ï¼šé¡¯è‘—ï¼ˆå¤§é‡è³‡æ–™ï¼‰
- ç”¨æˆ¶é«”é©—æ”¹å–„ï¼šæ˜é¡¯
- æ”¯æ´è¤‡é›œæŸ¥è©¢ï¼šé‡è¦
- è³‡æ–™å“è³ªç®¡ç†ï¼šæœ‰åƒ¹å€¼

ROIï¼šç´„ 300%ï¼ˆé«˜ï¼‰ âœ…
```

### ğŸ“Š **æ±ºç­–å»ºè­°**

#### **ç•¶å‰ï¼ˆ2025-11-06ï¼‰**
```
å•ï¼šæ–¹æ¡ˆ A æœ‰å¥½è™•å—ï¼Ÿ
ç­”ï¼šæœ‰å¥½è™•ï¼Œä½†ä¸é©åˆç¾åœ¨å¯¦æ–½

ç†ç”±ï¼š
âœ… æŠ€è¡“ä¸Šæœ‰ 6 å¤§å„ªå‹¢
âŒ ä½†è³‡æ–™é‡å¤ªå°ï¼ˆ7 ç­†ï¼‰
âŒ ROI ä¸é«˜ï¼ˆ20%ï¼‰
âŒ æˆæœ¬å¤§æ–¼æ”¶ç›Š
```

#### **æœªä¾†ï¼ˆè³‡æ–™é‡ > 500 ç­†æ™‚ï¼‰**
```
å•ï¼šæ–¹æ¡ˆ A å€¼å¾—å¯¦æ–½å—ï¼Ÿ
ç­”ï¼šå€¼å¾—è€ƒæ…®

è§¸ç™¼æ¢ä»¶ï¼ˆæ»¿è¶³ä»»ä¸€ï¼‰ï¼š
1. è³‡æ–™é‡ > 500 ç­†
2. æœ‰æ˜ç¢ºçš„ç²¾æº–åº¦å•é¡Œ
3. ç”¨æˆ¶åé¥‹æœç´¢çµæœä¸ä½³
4. A/B æ¸¬è©¦è­‰æ˜æœ‰é¡¯è‘—æ”¹å–„
```

---

**åˆ†æå®Œæˆæ—¥æœŸ**ï¼š2025-11-06  
**çµè«–**ï¼šæ–¹æ¡ˆ A æœ‰æ˜ç¢ºå¥½è™•ï¼Œä½†å»ºè­°ç­‰å¾…è³‡æ–™é‡é”åˆ°é–€æª»å¾Œå†å¯¦æ–½  
**ä¸‹ä¸€æ­¥**ï¼š
1. æŒçºŒä½¿ç”¨ç¾æœ‰æ–¹æ¡ˆï¼ˆé—œéµå­—æœç´¢æ”¹å–„ï¼‰
2. ç›£æ§è³‡æ–™é‡å¢é•·
3. æ”¶é›†ç”¨æˆ¶æœç´¢åé¥‹
4. ç•¶è§¸ç™¼æ¢ä»¶æ»¿è¶³æ™‚ï¼Œé‡æ–°è©•ä¼°æ–¹æ¡ˆ A
