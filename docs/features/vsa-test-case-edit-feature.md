# VSA 測試案例編輯功能

## 📋 功能概述

在 VSA 測試案例管理頁面中新增完整的編輯功能，允許用戶修改測試案例的各個欄位。

## ✨ 功能特性

### 1. **可編輯欄位**
用戶可以編輯以下欄位：

- ✅ **問題內容** (`question`)
  - 多行文本輸入
  - 支援最多 1000 字
  - 字數統計顯示
  - 必填欄位

- ✅ **Keyword 判斷條件** (`answer_keywords`)
  - 多標籤選擇器 (Tags mode)
  - 支援動態添加/刪除關鍵字
  - 輸入後按 Enter 添加
  - 支援中英文逗號分隔 (`,` 或 `，`)
  - 必填欄位（至少一個關鍵字）

- ✅ **難度等級** (`difficulty_level`)
  - 下拉選擇：簡單、中等、困難
  - 帶有顏色標籤提示
  - 必填欄位

- ✅ **測試案例狀態** (`is_active`)
  - Switch 開關控制
  - 啟用/停用切換
  - 提示：停用的測試案例不會被執行

- ✅ **刪除測試案例**
  - 危險操作區域（紅色按鈕）
  - 二次確認彈窗
  - 提示：刪除後無法恢復

## 🎨 UI/UX 設計

### 編輯 Modal
- **標題**：顯示測試案例 ID
- **寬度**：800px
- **表單布局**：垂直布局 (vertical)
- **表單驗證**：即時驗證，錯誤提示

### 表單欄位設計
1. **必填欄位標記**：紅色星號 `*`
2. **Tooltip 提示**：懸停顯示欄位說明
3. **佔位符**：友好的輸入提示
4. **標籤顏色**：
   - 簡單：綠色 (green)
   - 中等：橙色 (orange)
   - 困難：紅色 (red)

### 刪除區域設計
- 與編輯區域分隔線區隔
- 警告圖示和文字說明
- 紅色危險按鈕
- 二次確認對話框

## 🔧 技術實現

### 前端組件
**檔案**: `frontend/src/pages/benchmark/UnifiedTestCasePage.js`

#### State 管理
```javascript
const [editModalVisible, setEditModalVisible] = useState(false);
const [editForm] = Form.useForm();
```

#### 核心函數
1. **handleEdit(record)** - 打開編輯 Modal
2. **handleSaveEdit()** - 保存修改
3. **handleCancelEdit()** - 取消編輯

### API 調用
使用 `PATCH` 方法只更新指定欄位：

```javascript
await unifiedBenchmarkApi.patchTestCase(selectedCase.id, updateData);
```

**更新數據結構**:
```javascript
{
  question: string,
  answer_keywords: string[],
  difficulty_level: 'easy' | 'medium' | 'hard',
  is_active: boolean
}
```

### 表單驗證規則
```javascript
{
  question: { required: true, message: '請輸入問題' },
  answer_keywords: { required: true, message: '請至少添加一個關鍵字' },
  difficulty_level: { required: true, message: '請選擇難度' }
}
```

## 🚀 使用流程

### 1. 打開編輯 Modal
用戶點擊表格中的「編輯」按鈕（鉛筆圖標）

### 2. 修改欄位
- **修改問題**：直接在文本框中編輯
- **修改 Keywords**：
  - 刪除現有關鍵字：點擊標籤的 `x` 圖標
  - 添加新關鍵字：輸入後按 Enter
- **修改難度**：從下拉選單選擇
- **切換狀態**：點擊 Switch 開關

### 3. 保存或取消
- **保存修改**：點擊「保存修改」按鈕
  - 驗證表單
  - 調用 API 更新
  - 顯示成功訊息
  - 刷新表格數據
  
- **取消編輯**：點擊「取消」按鈕
  - 關閉 Modal
  - 重置表單

### 4. 刪除測試案例（可選）
- 點擊「刪除此測試案例」按鈕
- 確認刪除操作
- 同時關閉編輯 Modal

## 📊 功能截圖說明

### 編輯 Modal 布局
```
┌─────────────────────────────────────────────┐
│ 🖊️ 編輯測試案例 #110               [ X ]   │
├─────────────────────────────────────────────┤
│                                             │
│ * 問題內容                          📄 提示 │
│ ┌─────────────────────────────────────────┐ │
│ │ 這問題應該可以找到 Kingston Linux ...  │ │
│ │                                         │ │
│ └─────────────────────────────────────────┘ │
│                                   124 / 1000│
│                                             │
│ * Keyword 判斷條件                  📄 提示 │
│ ┌─────────────────────────────────────────┐ │
│ │ [Kingston] [Linux] [磁卡] [Kingston...] │ │
│ └─────────────────────────────────────────┘ │
│                                             │
│ * 難度等級                                  │
│ ┌─────────────────────────────────────────┐ │
│ │ 🟠 中等 - 進階問題              ▼      │ │
│ └─────────────────────────────────────────┘ │
│                                             │
│ 測試案例狀態                        📄 提示 │
│ [啟用 ●━━━━━○ 停用]                        │
│                                             │
│ ────────────────────────────────────────── │
│ ⚠️ 危險操作：刪除後無法恢復               │
│ ┌─────────────────────────────────────────┐ │
│ │      🗑️  刪除此測試案例                 │ │
│ └─────────────────────────────────────────┘ │
│                                             │
│              [ 取消 ]    [ 保存修改 ]       │
└─────────────────────────────────────────────┘
```

## ⚠️ 注意事項

1. **權限控制**：需要登入且有相應權限
2. **資料驗證**：必填欄位不能為空
3. **並發處理**：建議在保存前檢查數據是否被其他用戶修改
4. **刪除確認**：刪除操作需要二次確認，避免誤操作
5. **關鍵字限制**：至少需要一個關鍵字

## 🔄 更新歷史

### 2025-11-26
- ✅ 新增完整編輯功能
- ✅ 支援問題、關鍵字、難度、狀態編輯
- ✅ 新增表單驗證
- ✅ 新增友好的 UI 提示
- ✅ 整合刪除功能到編輯 Modal

## 📚 相關文件

- **API 文檔**: `/docs/api/unified-benchmark-api.md`
- **前端組件**: `frontend/src/pages/benchmark/UnifiedTestCasePage.js`
- **API 服務**: `frontend/src/services/unifiedBenchmarkApi.js`
- **後端 ViewSet**: `backend/api/views/viewsets/unified_benchmark_viewsets.py`

## 🎯 未來改進

1. **批量編輯**：支援批量修改多個測試案例
2. **歷史記錄**：顯示編輯歷史和版本對比
3. **權限細分**：不同用戶可編輯不同欄位
4. **自動保存**：定時自動保存草稿
5. **富文本編輯**：支援 Markdown 格式的問題描述

---

**更新時間**: 2025-11-26  
**負責人**: AI Platform Team
